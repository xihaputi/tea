if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const a="http://127.0.0.1:8000",s=(e,t,s={})=>new Promise(((l,o)=>{const r=uni.getStorageSync("token"),n={};r&&(n.Authorization=r),uni.request({url:`${a}${t}`,method:e,data:s,header:n,success:e=>{e.statusCode>=200&&e.statusCode<300?l(e.data):401===e.statusCode?(uni.removeStorageSync("token"),uni.showToast({title:"????",icon:"none"}),o(e)):o(e)},fail:o})})),l=(e,t)=>s("GET",e,t),o=(e,t)=>s("POST",e,t),r=(e,t)=>s("PUT",e,t),n=(e,t,s="file",l={})=>new Promise(((o,r)=>{const n=uni.getStorageSync("token"),i={};n&&(i.Authorization=n),uni.uploadFile({url:`${a}${e}`,filePath:t,name:s,formData:l,header:i,success:e=>{e.statusCode>=200&&e.statusCode<300?o(JSON.parse(e.data)):r(e)},fail:r})}));function i(e){return l(`/tea-gardens/${e}`)}function c(e,a=!1){return new Promise(((s,o)=>{const r="weather_cache_"+e;if(!a)try{const a=uni.getStorageSync(r);if(a){if(Date.now()-a.timestamp<18e5)return t("log","at api/weather.js:26","Weather cache hit:",e),void s(a.data)}}catch(n){t("error","at api/weather.js:32","Cache read failed",n)}t("log","at api/weather.js:37","Weather fetch:",e),l("/api/weather",{location:e}).then((e=>{if(e){try{uni.setStorageSync(r,{data:e,timestamp:Date.now()})}catch(n){t("error","at api/weather.js:47","Cache write failed",n)}s(e)}else o("No data")})).catch((e=>{o(e)}))}))}const d=Object.freeze(Object.defineProperty({__proto__:null,getWeather:c},Symbol.toStringTag,{value:"Module"})),m=(e,t)=>{const a=e.__vccOpts||e;for(const[s,l]of t)a[s]=l;return a};const p=m({data:()=>({stats:{garden_count:0,device_online_count:0,alarm_count:0},gardens:[],loading:!1,loading:!1,userName:"ç®¡ç†å‘˜",weather:{temperature:"--",weather:"è·å–ä¸­..."}}),onShow(){const e=uni.getStorageSync("userInfo");e&&(e.name||e.username)&&(this.userName=e.name||e.username),this.loadData()},onPullDownRefresh(){this.loadData()},methods:{async loadData(){this.loading=!0;try{const[a,s]=await Promise.all([l("/dashboard/stats"),(e={page:1,size:100},l("/tea-gardens",e))]);this.stats=a,this.gardens=s.list.map((e=>({...e,devices:e.totalCount||0,image:e.image_path?this.$baseUrl+e.image_path:"/static/default_garden.jpg",lastAlert:e.alarmCount>0?`${e.alarmCount}æ¡å‘Šè­¦å¾…å¤„ç†`:null}))),c("ä¿¡é˜³").then((e=>{e&&(this.weather=e)})).catch((e=>t("error","at pages/index/index.vue:124","Weather load failed",e))),this.gardens.forEach((e=>{c(e.address||e.name||"ä¿¡é˜³").catch((()=>{}))}))}catch(a){t("error","at pages/index/index.vue:133",a),uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}finally{this.loading=!1,uni.stopPullDownRefresh()}var e},goDetail(e){uni.navigateTo({url:`/pages/plot/index?garden_id=${e}`})}},computed:{greetingText(){const e=(new Date).getHours();return e<6?"å¤œæ·±äº†":e<9?"æ—©ä¸Šå¥½":e<12?"ä¸Šåˆå¥½":e<14?"ä¸­åˆå¥½":e<18?"ä¸‹åˆå¥½":"æ™šä¸Šå¥½"}}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("view",{class:"dashboard-header"},[e.createElementVNode("view",{class:"header-content"},[e.createElementVNode("text",{class:"greeting"},e.toDisplayString(r.greetingText)+"ï¼Œ"+e.toDisplayString(o.userName),1),e.createElementVNode("text",{class:"title-lg text-white"},"èŒ¶å›­æ€»è§ˆ")]),e.createElementVNode("view",{class:"weather-widget"},[e.createElementVNode("text",{class:"weather-temp"},e.toDisplayString(o.weather.temperature)+"Â°C",1),e.createElementVNode("text",{class:"weather-desc"},e.toDisplayString(o.weather.weather),1)])]),e.createElementVNode("view",{class:"stats-grid"},[e.createElementVNode("view",{class:"stat-card"},[e.createElementVNode("text",{class:"stat-val"},e.toDisplayString(o.stats.garden_count),1),e.createElementVNode("text",{class:"stat-label"},"èŒ¶å›­æ€»æ•°")]),e.createElementVNode("view",{class:"stat-card"},[e.createElementVNode("text",{class:"stat-val"},e.toDisplayString(o.stats.device_online_count),1),e.createElementVNode("text",{class:"stat-label"},"è®¾å¤‡åœ¨çº¿")]),e.createElementVNode("view",{class:e.normalizeClass(["stat-card",{warning:o.stats.alarm_count>0}])},[e.createElementVNode("text",{class:"stat-val"},e.toDisplayString(o.stats.alarm_count),1),e.createElementVNode("text",{class:"stat-label"},"å½“å‰å‘Šè­¦")],2)]),e.createElementVNode("view",{class:"section-title"},[e.createElementVNode("text",{class:"title-md"},"æˆ‘çš„èŒ¶å›­"),e.createElementVNode("text",{class:"text-sub"},"å…¨éƒ¨ >")]),e.createElementVNode("view",{class:"garden-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.gardens,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"card garden-card",onClick:e=>r.goDetail(t.id)},[e.createElementVNode("image",{class:"garden-cover",src:t.image,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"garden-info"},[e.createElementVNode("view",{class:"info-header"},[e.createElementVNode("text",{class:"garden-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:e.normalizeClass(["tag","normal"===t.status?"tag-primary":"tag-warn"])},e.toDisplayString("normal"===t.status?"æ­£å¸¸è¿è¡Œ":"éœ€å…³æ³¨"),3)]),e.createElementVNode("view",{class:"info-metrics"},[e.createElementVNode("view",{class:"metric-item"},[e.createElementVNode("text",{class:"metric-val"},e.toDisplayString(t.area)+"äº©",1),e.createElementVNode("text",{class:"metric-label"},"é¢ç§¯")]),e.createElementVNode("view",{class:"metric-divider"}),e.createElementVNode("view",{class:"metric-item"},[e.createElementVNode("text",{class:"metric-val"},e.toDisplayString(t.devices)+"å°",1),e.createElementVNode("text",{class:"metric-label"},"è®¾å¤‡")])]),t.lastAlert?(e.openBlock(),e.createElementBlock("view",{key:0,class:"alert-preview"},[e.createElementVNode("text",{class:"alert-icon"},"âš ï¸"),e.createElementVNode("text",{class:"alert-text"},e.toDisplayString(t.lastAlert),1)])):e.createCommentVNode("",!0)])],8,["onClick"])))),128))])])}],["__scopeId","data-v-4230cdaa"]]);const u=m({data:()=>({activeModule:"alarm",alarmTabs:["æœªè¯»","å·²å¤„ç†","å…¨éƒ¨"],currentAlarmTab:0,alarms:[],tasks:[],page:1,pageSize:10,total:0,loading:!1,hasMore:!0,isRefreshing:!1}),onLoad(){this.loadData()},onPullDownRefresh(){this.isRefreshing=!0,this.page=1,this.hasMore=!0,this.loadData()},onReachBottom(){this.hasMore&&!this.loading&&(this.page++,this.loadData())},watch:{activeModule(){this.resetPagination(),this.loadData()},currentAlarmTab(){"alarm"===this.activeModule&&(this.resetPagination(),this.loadData())}},methods:{switchModule(e){this.activeModule=e},resetPagination(){this.page=1,this.hasMore=!0,this.alarms=[],this.tasks=[]},async loadData(){if(!this.loading){this.loading=!0;try{"alarm"===this.activeModule?await this.loadAlarms():await this.loadTasks()}catch(e){t("error","at pages/alarm/index.vue:195",e),uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}finally{this.loading=!1,this.isRefreshing&&(this.isRefreshing=!1,uni.stopPullDownRefresh())}}},async loadAlarms(){let e="";0===this.currentAlarmTab?e="active":1===this.currentAlarmTab&&(e="cleared");const t=await(a={page:this.page,size:this.pageSize,status:e},l("/alarms",a));var a;const s=t.list||[];1===this.page?this.alarms=s:this.alarms=[...this.alarms,...s],this.total=t.total||0,this.hasMore=this.alarms.length<this.total},async loadTasks(){const e=await(t={page:this.page,size:this.pageSize,status:"pending"},l("/tasks/",t));var t;const a=e.list||[];1===this.page?this.tasks=a:this.tasks=[...this.tasks,...a],this.total=e.total||0,this.hasMore=this.tasks.length<this.total},severityClass:e=>"critical"===e?"bg-critical":"warning"===e?"bg-warning":"bg-info",statusTagClass:e=>"active"===e?"tag-danger":"tag-primary",statusText:e=>"active"===e?"å¾…å¤„ç†":"å·²æ¢å¤",handleAlarm(e){"active"===e.status&&uni.showActionSheet({itemList:["æ ‡è®°ä¸ºå·²å¤„ç†"],success:async t=>{if(0===t.tapIndex)try{await(a=e.id,r(`/alarms/${a}/ack`)),uni.showToast({title:"å·²æ ‡å¿—å¤„ç†",icon:"success"}),this.resetPagination(),this.loadData()}catch(s){uni.showToast({title:"æ“ä½œå¤±è´¥",icon:"none"})}var a}})},priorityText:e=>({high:"é«˜",medium:"ä¸­",low:"ä½"}[e]||"æ™®é€š"),formatDate:e=>e?new Date(e).toLocaleDateString():"",async completeTask(e){"completed"!==e.status&&uni.showModal({title:"ç¡®è®¤",content:"ç¡®å®šæ ‡è®°è¯¥ä»»åŠ¡ä¸ºå·²å®Œæˆå—ï¼Ÿ",success:async t=>{if(t.confirm)try{await(a=e.id,s={status:"completed"},r(`/tasks/${a}`,s)),uni.showToast({title:"ä»»åŠ¡å·²å®Œæˆ"}),this.resetPagination(),this.loadData()}catch(l){uni.showToast({title:"æ“ä½œå¤±è´¥",icon:"none"})}var a,s}})},handleTask(e){}}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title-lg"},"äº‹åŠ¡ä¸­å¿ƒ"),e.createElementVNode("view",{class:"top-segment"},[e.createElementVNode("view",{class:e.normalizeClass(["segment-item",{active:"alarm"===o.activeModule}]),onClick:a[0]||(a[0]=e=>r.switchModule("alarm"))}," å‘Šè­¦ä¿¡æ¯ ",2),e.createElementVNode("view",{class:e.normalizeClass(["segment-item",{active:"task"===o.activeModule}]),onClick:a[1]||(a[1]=e=>r.switchModule("task"))}," å¾…åŠäº‹é¡¹ ",2)])]),"alarm"===o.activeModule?(e.openBlock(),e.createElementBlock("view",{key:0,class:"filter-tabs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.alarmTabs,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["tab-item",{active:o.currentAlarmTab===a}]),onClick:e=>o.currentAlarmTab=a},e.toDisplayString(t),11,["onClick"])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content-area"},["alarm"===o.activeModule?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.alarms,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"card alarm-card"},[e.createElementVNode("view",{class:"card-top"},[e.createElementVNode("view",{class:"garden-info"},[e.createElementVNode("text",{class:"garden-name"},e.toDisplayString(t.gardenName||"æœªçŸ¥èŒ¶å›­"),1),e.createElementVNode("text",{class:"device-name"}," Â· "+e.toDisplayString(t.deviceName||"æœªçŸ¥è®¾å¤‡"),1)]),e.createElementVNode("text",{class:"time"},e.toDisplayString(t.created_at),1)]),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("view",{class:e.normalizeClass(["severity-indicator",r.severityClass(t.severity)])},null,2),e.createElementVNode("text",{class:"alarm-text"},e.toDisplayString(t.content),1)]),e.createElementVNode("view",{class:"card-actions"},[e.createElementVNode("view",{class:e.normalizeClass(["tag",r.statusTagClass(t.status)])},e.toDisplayString(r.statusText(t.status)),3),e.createElementVNode("view",{class:"action-btn",onClick:e=>r.handleAlarm(t)}," å¤„ç† > ",8,["onClick"])])])))),128)),o.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-more"},[e.createElementVNode("text",null,"åŠ è½½ä¸­...")])):e.createCommentVNode("",!0),o.loading||0!==o.alarms.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty"},[e.createElementVNode("text",null,"æš‚æ— å‘Šè­¦ä¿¡æ¯")]))],64)):e.createCommentVNode("",!0),"task"===o.activeModule?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.tasks,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"card task-card",onClick:e=>r.handleTask(t)},[e.createElementVNode("view",{class:"task-top"},[e.createElementVNode("text",{class:"task-title"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:e.normalizeClass(["task-priority","p-"+(t.priority||"medium")])},e.toDisplayString(r.priorityText(t.priority)),3)]),e.createElementVNode("view",{class:"task-desc"},e.toDisplayString(t.description||"æš‚æ— æè¿°"),1),e.createElementVNode("view",{class:"task-meta"},[e.createElementVNode("view",{class:"meta-item"},[e.createElementVNode("text",{class:"icon"},"ğŸ“…"),e.createElementVNode("text",null,e.toDisplayString(r.formatDate(t.deadline)||"æ— æˆªæ­¢æ—¥æœŸ"),1)]),e.createElementVNode("view",{class:"meta-item"},[e.createElementVNode("text",{class:"icon"},"ğŸ‘¤"),e.createElementVNode("text",null,e.toDisplayString(t.assignee||"æœªåˆ†é…"),1)])]),e.createElementVNode("view",{class:"task-footer"},[e.createElementVNode("view",{class:e.normalizeClass(["status-badge",t.status])},e.toDisplayString("completed"===t.status?"å·²å®Œæˆ":"è¿›è¡Œä¸­"),3),e.createElementVNode("view",{class:"btn-check",onClick:e.withModifiers((e=>r.completeTask(t)),["stop"])},e.toDisplayString("completed"===t.status?"å·²å½’æ¡£":"æ ‡è®°å®Œæˆ"),9,["onClick"])])],8,["onClick"])))),128)),o.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-more"},[e.createElementVNode("text",null,"åŠ è½½ä¸­...")])):e.createCommentVNode("",!0),o.loading||0!==o.tasks.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty"},[e.createElementVNode("text",null,"æš‚æ— å¾…åŠä»»åŠ¡")]))],64)):e.createCommentVNode("",!0)])])}],["__scopeId","data-v-923ba9ce"]]);const g=m({data:()=>({plotId:null,sensor:null,advice:null,loading:!1,error:""}),onLoad(e){this.plotId=Number(e.plot_id),this.refresh()},methods:{async refresh(){if(this.plotId){this.loading=!0,this.error="";try{const[e,t]=await Promise.all([l("/sensor/latest",{plot_id:this.plotId}),l("/advice/today",{plot_id:this.plotId})]);this.sensor=e,this.advice=t}catch(e){this.error="åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡"}finally{this.loading=!1}}else this.error="æœªä¼ é€’åœ°å— ID"},formatTime:e=>e?e.replace("T"," ").replace("Z",""):"--",pillClass:e=>"optimal"===e?"pill-optimal":"water"===e?"pill-water":"drain"===e?"pill-drain":"pill-optimal",adviceText:e=>"optimal"===e?"é€‚å®œ":"water"===e?"å»ºè®®æµ‡æ°´":"drain"===e?"æ³¨æ„æ’æ°´":e||"æœªçŸ¥"}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"title",style:{padding:"24rpx 24rpx 8rpx"}},"åœ°å—è¯¦æƒ…"),e.createElementVNode("view",{class:"subtitle",style:{padding:"0 24rpx 16rpx"}},"ç¼–å· "+e.toDisplayString(o.plotId),1),o.error?(e.openBlock(),e.createElementBlock("view",{key:0,class:"card",style:{color:"#ef4444"}},e.toDisplayString(o.error),1)):e.createCommentVNode("",!0),o.loading?(e.openBlock(),e.createElementBlock("view",{key:1,class:"card"},"åŠ è½½ä¸­...")):e.createCommentVNode("",!0),o.sensor?(e.openBlock(),e.createElementBlock("view",{key:2,class:"card"},[e.createElementVNode("view",{class:"title"},"ç¯å¢ƒæ•°æ®"),e.createElementVNode("view",{class:"subtitle"},"æœ€è¿‘è®°å½•ï¼š"+e.toDisplayString(r.formatTime(o.sensor.timestamp)),1),e.createElementVNode("view",{style:{"margin-top":"12rpx"}},[e.createElementVNode("view",null,"åœŸå£¤æ¹¿åº¦ï¼š"+e.toDisplayString(o.sensor.soil_moisture)+"%",1),e.createElementVNode("view",null,"æ°”æ¸©ï¼š"+e.toDisplayString(o.sensor.temperature||"--")+" â„ƒ",1),e.createElementVNode("view",null,"æ¹¿åº¦ï¼š"+e.toDisplayString(o.sensor.humidity||"--")+" %",1)])])):e.createCommentVNode("",!0),o.advice?(e.openBlock(),e.createElementBlock("view",{key:3,class:"card"},[e.createElementVNode("view",{class:"title"},"ä»Šæ—¥å»ºè®®"),e.createElementVNode("view",{class:"subtitle"},"åŸºäºæœ€æ–°åœŸå£¤æ¹¿åº¦"),e.createElementVNode("view",{style:{margin:"12rpx 0"}},[e.createElementVNode("text",{class:e.normalizeClass(["pill",r.pillClass(o.advice.level)])},e.toDisplayString(r.adviceText(o.advice.level)),3)]),e.createElementVNode("view",null,e.toDisplayString(o.advice.advice),1),e.createElementVNode("view",{class:"subtitle",style:{"margin-top":"12rpx"}},e.toDisplayString(r.formatTime(o.advice.timestamp)),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"btn-primary",onClick:a[0]||(a[0]=(...e)=>r.refresh&&r.refresh(...e))},"åˆ·æ–°æ•°æ®")])])}],["__scopeId","data-v-a1373aa2"]]);const h=m({data:()=>({filePath:"",result:null,uploading:!1,error:""}),methods:{chooseImage(){uni.chooseImage({count:1,sizeType:["compressed"],success:e=>{this.filePath=e.tempFilePaths[0],this.result=null,this.error=""},fail:()=>{}})},async upload(){if(this.filePath){this.uploading=!0,this.error="";try{const a=await(e=this.filePath,n("/disease/detect",e,"file",{plot_id:t||""}));this.result=a}catch(a){this.error="è¯†åˆ«å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é‡è¯•"}finally{this.uploading=!1}var e,t}}}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("view",{class:"header-box"},[e.createElementVNode("view",{class:"title-lg"},"ç—…è™«å®³æ™ºèƒ½è¯Šæ–­"),e.createElementVNode("view",{class:"text-sub",style:{"margin-top":"8rpx"}},"æ‹æ‘„èŒ¶æ ‘å¶ç‰‡ï¼ŒAI å¿«é€Ÿè¯†åˆ«ç—…å®³ç±»å‹")]),e.createElementVNode("view",{class:"upload-card",onClick:a[0]||(a[0]=(...e)=>r.chooseImage&&r.chooseImage(...e))},[o.filePath?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("image",{src:o.filePath,mode:"aspectFit",class:"preview-img"},null,8,["src"]),e.createElementVNode("view",{class:"re-upload-btn"},"é‡æ–°æ‹ç…§")],64)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"upload-placeholder"},[e.createElementVNode("text",{class:"camera-icon"},"ğŸ“¸"),e.createElementVNode("text",{class:"upload-text"},"ç‚¹å‡»ä¸Šä¼  / æ‹æ‘„ç…§ç‰‡"),e.createElementVNode("text",{class:"upload-hint"},"è¯·ç¡®ä¿å…‰çº¿å……è¶³ï¼Œç—…ç¶æ¸…æ™°")]))]),!o.filePath||o.uploading||o.result?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn-primary full-btn",onClick:a[1]||(a[1]=e.withModifiers(((...e)=>r.upload&&r.upload(...e)),["stop"]))},"å¼€å§‹è¯Šæ–­")),o.uploading?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn-primary full-btn disabled",disabled:""},"æ­£åœ¨åˆ†æ...")):e.createCommentVNode("",!0),o.result?(e.openBlock(),e.createElementBlock("view",{key:2,class:"card result-card"},[e.createElementVNode("view",{class:"result-header"},[e.createElementVNode("text",{class:"result-title"},"è¯Šæ–­ç»“æœ"),e.createElementVNode("view",{class:"confidence-tag"},"å¯ä¿¡åº¦ "+e.toDisplayString((100*o.result.confidence).toFixed(1))+"%",1)]),e.createElementVNode("view",{class:"result-row"},[e.createElementVNode("text",{class:"label"},"ç—…å®³ç±»å‹ï¼š"),e.createElementVNode("text",{class:"value highlight"},e.toDisplayString(o.result.disease_type),1)]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"advice-section"},[e.createElementVNode("text",{class:"label"},"é˜²æ²»å»ºè®®ï¼š"),e.createElementVNode("text",{class:"advice-text"},e.toDisplayString(o.result.advice),1)])])):e.createCommentVNode("",!0),o.error?(e.openBlock(),e.createElementBlock("view",{key:3,class:"error-msg"},e.toDisplayString(o.error),1)):e.createCommentVNode("",!0)])}],["__scopeId","data-v-8d1bbe19"]]);const v=m({data:()=>({question:"",history:[],sessionId:null,loading:!1}),onLoad(){this.loadHistory()},methods:{async loadHistory(){try{const e=await l("/chat/latest");e.session_id&&(this.sessionId=e.session_id,this.history=e.history||[],this.scrollToBottom())}catch(e){t("error","at pages/chat/chat.vue:70","Failed to load history",e)}},async ask(){if(!this.question||this.loading)return;const e=this.question;this.question="",this.history.push({role:"user",content:e}),this.scrollToBottom(),this.loading=!0;try{const a=await(t={question:e,history:this.history.map((e=>({role:e.role,content:e.content}))),session_id:this.sessionId},o("/chat/ask",t));a.session_id&&(this.sessionId=a.session_id),this.history.push({role:"assistant",content:a.answer})}catch(a){this.history.push({role:"assistant",content:"æŠ±æ­‰ï¼Œæˆ‘ç°åœ¨æ— æ³•å›ç­”ï¼Œè¯·ç¨åå†è¯•ã€‚"})}finally{this.loading=!1,this.scrollToBottom()}var t},scrollToBottom(){setTimeout((()=>{uni.pageScrollTo({scrollTop:99999,duration:300})}),100)}}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page-container chat-page"},[e.createElementVNode("view",{class:"chat-list"},[e.createElementVNode("view",{class:"system-msg"},[e.createElementVNode("text",{class:"system-text"},"AI èŒ¶å†œé¡¾é—®ä¸ºæ‚¨æœåŠ¡ï¼Œè¯·æé—®")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.history,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["msg-row","user"===t.role?"msg-right":"msg-left"])},["assistant"===t.role?(e.openBlock(),e.createElementBlock("view",{key:0,class:"avatar ai-avatar"},"ğŸ¤–")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["bubble","user"===t.role?"bubble-user":"bubble-ai"])},[e.createElementVNode("text",{class:"msg-content"},e.toDisplayString(t.content),1)],2),"user"===t.role?(e.openBlock(),e.createElementBlock("view",{key:1,class:"avatar user-avatar"},"ğŸ‘¤")):e.createCommentVNode("",!0)],2)))),128)),o.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"msg-row msg-left"},[e.createElementVNode("view",{class:"avatar ai-avatar"},"ğŸ¤–"),e.createElementVNode("view",{class:"bubble bubble-ai"},[e.createElementVNode("text",{class:"msg-content"},"æ€è€ƒä¸­...")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{style:{height:"120rpx"}})]),e.createElementVNode("view",{class:"input-area"},[e.createElementVNode("view",{class:"input-box"},[e.withDirectives(e.createElementVNode("input",{class:"chat-input","onUpdate:modelValue":a[0]||(a[0]=e=>o.question=e),placeholder:"è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...",onConfirm:a[1]||(a[1]=(...e)=>r.ask&&r.ask(...e))},null,544),[[e.vModelText,o.question]]),e.createElementVNode("view",{class:e.normalizeClass(["send-btn",{disabled:!o.question||o.loading}]),onClick:a[2]||(a[2]=(...e)=>r.ask&&r.ask(...e))},[e.createElementVNode("text",{class:"send-icon"},"â†‘")],2)])])])}],["__scopeId","data-v-95d71273"]]);const w=m({methods:{goChat(){uni.navigateTo({url:"/pages/chat/chat"})},goDisease(){uni.navigateTo({url:"/pages/disease/disease"})},showToast(e){uni.showToast({title:e,icon:"none"})}}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("view",{class:"header-section"},[e.createElementVNode("view",{class:"title-lg"},"AI æ™ºèƒ½åŠ©æ‰‹"),e.createElementVNode("view",{class:"text-sub",style:{"margin-top":"8rpx"}},"æ‚¨çš„ç§äººèŒ¶å›­ç®¡ç†ä¸“å®¶")]),e.createElementVNode("view",{class:"service-grid"},[e.createElementVNode("view",{class:"service-card",onClick:a[0]||(a[0]=(...e)=>r.goChat&&r.goChat(...e))},[e.createElementVNode("view",{class:"icon-box icon-chat"},[e.createElementVNode("text",{class:"emoji"},"ğŸ¤–")]),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("view",{class:"card-title"},"å¯¹è¯å’¨è¯¢"),e.createElementVNode("view",{class:"card-desc"},"è§£ç­”ç§æ¤ã€ç—…è™«å®³ã€æ–½è‚¥ç­‰ä¸“ä¸šé—®é¢˜")]),e.createElementVNode("view",{class:"action-arrow"},"â†’")]),e.createElementVNode("view",{class:"service-card",onClick:a[1]||(a[1]=(...e)=>r.goDisease&&r.goDisease(...e))},[e.createElementVNode("view",{class:"icon-box icon-camera"},[e.createElementVNode("text",{class:"emoji"},"ğŸ“¸")]),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("view",{class:"card-title"},"ç—…è™«å®³è¯Šæ–­"),e.createElementVNode("view",{class:"card-desc"},"æ‹ç…§è¯†åˆ«ç—…å®³ï¼Œè·å–é˜²æ²»æ–¹æ¡ˆ")]),e.createElementVNode("view",{class:"action-arrow"},"â†’")]),e.createElementVNode("view",{class:"service-card disabled",onClick:a[2]||(a[2]=e=>r.showToast("å³å°†ä¸Šçº¿"))},[e.createElementVNode("view",{class:"icon-box icon-chart"},[e.createElementVNode("text",{class:"emoji"},"ğŸ“ˆ")]),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("view",{class:"card-title"},"äº§é‡é¢„æµ‹"),e.createElementVNode("view",{class:"card-desc"},"åŸºäºå†å²æ•°æ®é¢„æµ‹ä¸‹ä¸€å­£äº§é‡")]),e.createElementVNode("view",{class:"tag-coming"},"Coming")])])])}],["__scopeId","data-v-dbbd288e"]]);const E=m({data:()=>({user:{}}),onShow(){this.loadUserInfo()},methods:{async loadUserInfo(){try{const e=await l("/auth/user/info");this.user=e}catch(e){}},async handleLogout(){try{await o("/auth/logout")}catch(e){}uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),uni.reLaunch({url:"/pages/login/index"})},showToast(e){uni.showToast({title:e,icon:"none"})}}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("view",{class:"profile-header"},[e.createElementVNode("view",{class:"title-lg text-white"},"ä¸ªäººä¸­å¿ƒ")]),e.createElementVNode("view",{class:"profile-content"},[e.createElementVNode("view",{class:"card user-card"},[e.createElementVNode("view",{class:"avatar-box"},[e.createElementVNode("text",{class:"avatar-text"},e.toDisplayString(o.user.name?o.user.name[0]:o.user.username?o.user.username[0]:"U"),1)]),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("text",{class:"user-name"},e.toDisplayString(o.user.name||o.user.username),1),e.createElementVNode("view",{class:"user-role-tag"},e.toDisplayString(o.user.roles?o.user.roles.join(", "):"æ™®é€šç”¨æˆ·"),1)]),e.createElementVNode("view",{class:"edit-btn",onClick:a[0]||(a[0]=e=>r.showToast("ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­"))},"âœ")]),e.createElementVNode("view",{class:"card menu-card"},[e.createElementVNode("view",{class:"menu-item",onClick:a[1]||(a[1]=e=>r.showToast("è´¦å·å®‰å…¨åŠŸèƒ½å¼€å‘ä¸­"))},[e.createElementVNode("view",{class:"menu-left"},[e.createElementVNode("text",{class:"menu-icon"},"ğŸ›¡ï¸"),e.createElementVNode("text",{class:"menu-text"},"è´¦å·ä¸å®‰å…¨")]),e.createElementVNode("text",{class:"menu-arrow"},"â€º")]),e.createElementVNode("view",{class:"menu-divider"}),e.createElementVNode("view",{class:"menu-item",onClick:a[2]||(a[2]=e=>r.showToast("ç³»ç»Ÿè®¾ç½®åŠŸèƒ½å¼€å‘ä¸­"))},[e.createElementVNode("view",{class:"menu-left"},[e.createElementVNode("text",{class:"menu-icon"},"âš™ï¸"),e.createElementVNode("text",{class:"menu-text"},"ç³»ç»Ÿè®¾ç½®")]),e.createElementVNode("text",{class:"menu-arrow"},"â€º")]),e.createElementVNode("view",{class:"menu-divider"}),e.createElementVNode("view",{class:"menu-item",onClick:a[3]||(a[3]=e=>r.showToast("å…³äºæˆ‘ä»¬åŠŸèƒ½å¼€å‘ä¸­"))},[e.createElementVNode("view",{class:"menu-left"},[e.createElementVNode("text",{class:"menu-icon"},"â„¹ï¸"),e.createElementVNode("text",{class:"menu-text"},"å…³äºæˆ‘ä»¬")]),e.createElementVNode("text",{class:"menu-arrow"},"â€º")])]),e.createElementVNode("button",{class:"btn-logout",onClick:a[4]||(a[4]=(...e)=>r.handleLogout&&r.handleLogout(...e))},"é€€å‡ºç™»å½•")])])}],["__scopeId","data-v-01e0070c"]]);const N=m({data:()=>({plotId:null,sensor:null,advice:null,loading:!1,error:""}),onLoad(e){this.plotId=Number(e.plot_id),this.refresh()},methods:{async refresh(){if(this.plotId){this.loading=!0,this.error="";try{const[e,t]=await Promise.all([l("/sensor/latest",{plot_id:this.plotId}),l("/advice/today",{plot_id:this.plotId})]);this.sensor=e,this.advice=t}catch(e){this.error="åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡"}finally{this.loading=!1}}else this.error="æœªä¼ é€’åœ°å— ID"},formatTime:e=>e?e.replace("T"," ").replace("Z",""):"--",pillClass:e=>"optimal"===e?"pill-optimal":"water"===e?"pill-water":"drain"===e?"pill-drain":"pill-optimal",adviceText:e=>"optimal"===e?"é€‚å®œ":"water"===e?"å»ºè®®æµ‡æ°´":"drain"===e?"æ³¨æ„æ’æ°´":e||"æœªçŸ¥"}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page"},[e.createElementVNode("view",{class:"title",style:{padding:"24rpx 24rpx 8rpx"}},"åœ°å—è¯¦æƒ…"),e.createElementVNode("view",{class:"subtitle",style:{padding:"0 24rpx 16rpx"}},"ç¼–å· "+e.toDisplayString(o.plotId),1),o.error?(e.openBlock(),e.createElementBlock("view",{key:0,class:"card",style:{color:"#ef4444"}},e.toDisplayString(o.error),1)):e.createCommentVNode("",!0),o.loading?(e.openBlock(),e.createElementBlock("view",{key:1,class:"card"},"åŠ è½½ä¸­...")):e.createCommentVNode("",!0),o.sensor?(e.openBlock(),e.createElementBlock("view",{key:2,class:"card"},[e.createElementVNode("view",{class:"title"},"ç¯å¢ƒæ•°æ®"),e.createElementVNode("view",{class:"subtitle"},"æœ€è¿‘è®°å½•ï¼š"+e.toDisplayString(r.formatTime(o.sensor.timestamp)),1),e.createElementVNode("view",{style:{"margin-top":"12rpx"}},[e.createElementVNode("view",null,"åœŸå£¤æ¹¿åº¦ï¼š"+e.toDisplayString(o.sensor.soil_moisture)+"%",1),e.createElementVNode("view",null,"æ°”æ¸©ï¼š"+e.toDisplayString(o.sensor.temperature||"--")+" â„ƒ",1),e.createElementVNode("view",null,"æ¹¿åº¦ï¼š"+e.toDisplayString(o.sensor.humidity||"--")+" %",1)])])):e.createCommentVNode("",!0),o.advice?(e.openBlock(),e.createElementBlock("view",{key:3,class:"card"},[e.createElementVNode("view",{class:"title"},"ä»Šæ—¥å»ºè®®"),e.createElementVNode("view",{class:"subtitle"},"åŸºäºæœ€æ–°åœŸå£¤æ¹¿åº¦"),e.createElementVNode("view",{style:{margin:"12rpx 0"}},[e.createElementVNode("text",{class:e.normalizeClass(["pill",r.pillClass(o.advice.level)])},e.toDisplayString(r.adviceText(o.advice.level)),3)]),e.createElementVNode("view",null,e.toDisplayString(o.advice.advice),1),e.createElementVNode("view",{class:"subtitle",style:{"margin-top":"12rpx"}},e.toDisplayString(r.formatTime(o.advice.timestamp)),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"btn-primary",onClick:a[0]||(a[0]=(...e)=>r.refresh&&r.refresh(...e))},"åˆ·æ–°æ•°æ®")])])}],["__scopeId","data-v-c6b8a1fb"]]);const V=m({data:()=>({gardenId:null,garden:{},devices:[],loading:!1,lastUpdated:"",rulesMap:{},weather:{temperature:"--",weather:"Loading...",humidity:"--",windPower:"-"},sensorList:[],aiAdvice:[{type:"info",text:"æ­£åœ¨åˆ†æç¯å¢ƒæ•°æ®..."}]}),computed:{gardenImage(){return this.garden.image_path?this.$baseUrl+this.garden.image_path:"/static/garden_bg.png"},gardenStatusText(){return"normal"===(this.garden.status||"normal")?"æ­£å¸¸è¿è¡Œ":"éœ€å…³æ³¨"},gardenStatusClass(){return"normal"===(this.garden.status||"normal")?"tag-primary":"tag-warn"}},onLoad(e){e.garden_id&&(this.gardenId=e.garden_id,this.loadData())},onPullDownRefresh(){this.loadData().then((()=>{uni.stopPullDownRefresh()}))},methods:{async loadData(){this.loading=!0;try{await this.fetchRules();const[a,s]=await Promise.all([i(this.gardenId),(e=this.gardenId,l(`/tea-gardens/${e}/devices`))]);this.garden=a,this.devices=s,uni.setNavigationBarTitle({title:a.name}),await this.fetchSensorData(s);c(a.address||a.name||"ä¿¡é˜³").then((e=>{e&&(this.weather=e)})).catch((e=>t("error","at pages/plot/index.vue:211","Plot weather load failed",e)))}catch(a){t("error","at pages/plot/index.vue:214",a),uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}finally{this.loading=!1}var e},async fetchRules(){try{const e=await l("/rules/sensor");e&&e.forEach((e=>{try{this.rulesMap[e.sensor_key]=JSON.parse(e.rule_config)}catch(t){}}))}catch(e){t("error","at pages/plot/index.vue:232","Fetch rules failed",e)}},computeStatus(e,t){const a=parseFloat(t);if(isNaN(a))return null;const s=this.rulesMap[e];if(!s)return null;for(const l of s){const e=null!==l.min&&void 0!==l.min?l.min:-1/0,t=null!==l.max&&void 0!==l.max?l.max:1/0;if(a>=e&&a<t)return{label:l.label,color:l.color}}return null},async fetchSensorData(e){const a=[],s=e.map((async e=>{try{const t=await(s=e.id,l(`/devices/${s}/telemetry`));let r={};try{e.sensor_config&&(r=JSON.parse(e.sensor_config))}catch(o){}const n={};Array.isArray(t)?t.forEach((e=>{n[e.key]||(n[e.key]=e.value)})):"object"==typeof t&&Object.assign(n,t);for(const[s,l]of Object.entries(n)){if(r.__ignored&&r.__ignored.includes(s))continue;if("ts"===s)continue;if(["battery","signal","version"].includes(s))continue;const t=r[s]||{},o=t.name||this.formatKeyName(s),n=t.unit||this.guessUnit(s),i=this.computeStatus(s,l);a.push({label:o,value:l+n,rawVal:parseFloat(l),key:s,deviceName:e.name,status:i?i.label:null,statusColor:i?i.color:null})}}catch(o){t("error","at pages/plot/index.vue:302",`Device ${e.id} telemetry error`,o)}var s}));await Promise.all(s),this.sensorList=a;const o=new Date,r=String(o.getHours()).padStart(2,"0"),n=String(o.getMinutes()).padStart(2,"0"),i=String(o.getSeconds()).padStart(2,"0");this.lastUpdated=`${r}:${n}:${i}`,this.generateAiAdvice(a)},formatKeyName:e=>({temperature:"æ¸©åº¦",humidity:"æ¹¿åº¦",soil_moisture:"åœŸå£¤æ¹¿åº¦",light:"å…‰ç…§",co2:"CO2æµ“åº¦"}[e]||e),guessUnit:e=>e.includes("temp")?"â„ƒ":e.includes("humidity")||e.includes("moisture")?"%":e.includes("light")?"Lux":"",generateAiAdvice(e){const t=[],a=e.find((e=>e.key.includes("temp")));e.find((e=>e.key.includes("humidity")));const s=e.find((e=>e.key.includes("soil")));a&&(a.rawVal>30?t.push({type:"warning",text:`æ°”æ¸©è¾ƒé«˜(${a.value})ï¼Œæ³¨æ„èŒ¶æ ‘é˜²æ™’ã€‚`}):a.rawVal<5&&t.push({type:"warning",text:`æ°”æ¸©è¾ƒä½(${a.value})ï¼Œæ³¨æ„é˜²å†»ã€‚`})),s&&s.rawVal<30&&t.push({type:"warning",text:`åœŸå£¤è¾ƒå¹²(${s.value})ï¼Œå»ºè®®çŒæº‰ã€‚`}),0===t.length&&(t.push({type:"info",text:"å½“å‰ç¯å¢ƒé€‚å®œï¼ŒèŒ¶æ ‘ç”Ÿé•¿çŠ¶å†µè‰¯å¥½ã€‚"}),t.push({type:"info",text:"å»ºè®®è¿›è¡Œå¸¸è§„å·¡å›­æ£€æŸ¥ã€‚"})),this.aiAdvice=t},goEdit(){uni.navigateTo({url:`/pages/plot/edit_garden?id=${this.gardenId}`})},deviceStatusText:e=>"online"===e?"åœ¨çº¿":"ç¦»çº¿",deviceStatusClass:e=>"online"===e?"text-primary":"text-sub",formatTime(e){if(!e)return"-";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},goDeviceDetail(e){uni.showToast({title:"è®¾å¤‡è¯¦æƒ…å¼€å‘ä¸­",icon:"none"})}}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[o.garden.name?(e.openBlock(),e.createElementBlock("view",{key:0,class:"hero-header"},[e.createElementVNode("image",{class:"hero-bg",src:r.gardenImage,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"hero-overlay"},[e.createElementVNode("view",{class:"hero-content"},[e.createElementVNode("view",{class:"hero-top"},[e.createElementVNode("view",{style:{display:"flex","align-items":"center",gap:"12rpx"}},[e.createElementVNode("text",{class:"hero-title"},e.toDisplayString(o.garden.name),1),e.createElementVNode("view",{class:e.normalizeClass(["tag",r.gardenStatusClass])},e.toDisplayString(r.gardenStatusText),3)]),e.createElementVNode("view",{class:"btn-icon-glass",onClick:a[0]||(a[0]=(...e)=>r.goEdit&&r.goEdit(...e))}," âœ ")]),e.createElementVNode("view",{class:"hero-info"},[e.createElementVNode("text",{class:"info-text"},e.toDisplayString(o.garden.company||"æœªå½’å±å…¬å¸"),1),o.garden.manager?(e.openBlock(),e.createElementBlock("text",{key:0,class:"info-text"}," | è´Ÿè´£äºº: "+e.toDisplayString(o.garden.manager),1)):e.createCommentVNode("",!0)])])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"content-wrapper"},[e.createElementVNode("view",{class:"card weather-card"},[e.createElementVNode("view",{class:"card-header-sm"},[e.createElementVNode("text",{class:"card-title-sm"},"ğŸ“ èŒ¶å›­ä½ç½®ä¸å¤©æ°”")]),e.createElementVNode("view",{class:"weather-body"},[e.createElementVNode("view",{class:"location-row"},[e.createElementVNode("text",{class:"address-text"},e.toDisplayString(o.garden.address||"åœ°å€æœªé…ç½®"),1)]),e.createElementVNode("view",{class:"weather-row"},[e.createElementVNode("view",{class:"weather-main"},[e.createElementVNode("text",{class:"temp"},e.toDisplayString(o.weather.temperature)+"Â°C",1),e.createElementVNode("text",{class:"weather-desc"},e.toDisplayString(o.weather.weather),1)]),e.createElementVNode("view",{class:"weather-details"},[e.createElementVNode("view",{class:"detail-item"},[e.createElementVNode("text",{class:"label"},"æ¹¿åº¦"),e.createElementVNode("text",{class:"val"},e.toDisplayString(o.weather.humidity)+"%",1)]),e.createElementVNode("view",{class:"detail-item"},[e.createElementVNode("text",{class:"label"},"é£åŠ›"),e.createElementVNode("text",{class:"val"},e.toDisplayString(o.weather.windPower)+"çº§",1)])])])])]),e.createElementVNode("view",{class:"card sensor-card"},[e.createElementVNode("view",{class:"card-header-sm"},[e.createElementVNode("text",{class:"card-title-sm"},"ğŸŒ± ç¯å¢ƒç›‘æµ‹"),o.lastUpdated?(e.openBlock(),e.createElementBlock("text",{key:0,class:"update-time"},"æ›´æ–°äº "+e.toDisplayString(o.lastUpdated),1)):e.createCommentVNode("",!0)]),o.sensorList.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"sensor-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.sensorList,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"sensor-item",key:a},[e.createElementVNode("text",{class:"status-main",style:e.normalizeStyle({color:t.statusColor||"#333"})},e.toDisplayString(t.status||"ç›‘æµ‹ä¸­"),5),e.createElementVNode("view",{class:"sensor-sub"},[e.createElementVNode("text",{class:"sensor-label"},e.toDisplayString(t.label),1),e.createElementVNode("text",{class:"sensor-val-sm"},e.toDisplayString(t.value),1)])])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-sensor"},[e.createElementVNode("text",null,"æš‚æ— ç¯å¢ƒæ•°æ®")]))]),e.createElementVNode("view",{class:"card advice-card"},[e.createElementVNode("view",{class:"card-header-sm"},[e.createElementVNode("text",{class:"card-title-sm"},"ğŸ¤– AI å†œäº‹å»ºè®®")]),e.createElementVNode("view",{class:"advice-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.aiAdvice,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["advice-item",t.type]),key:a},[e.createElementVNode("text",{class:"advice-icon"},e.toDisplayString("warning"===t.type?"âš ï¸":"ğŸ’¡"),1),e.createElementVNode("text",{class:"advice-text"},e.toDisplayString(t.text),1)],2)))),128))])]),e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"title-md"},"è®¾å¤‡åˆ—è¡¨"),e.createElementVNode("text",{class:"text-sub"},"å…± "+e.toDisplayString(o.devices.length)+" å°",1)]),e.createElementVNode("view",{class:"device-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.devices,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"card device-card",onClick:e=>r.goDeviceDetail(t.id)},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("view",{class:"header-left"},[e.createElementVNode("text",{class:"card-title"},e.toDisplayString(t.name),1)]),e.createElementVNode("text",{class:e.normalizeClass(["status-text",r.deviceStatusClass(t.status)])}," â— "+e.toDisplayString(r.deviceStatusText(t.status)),3)]),e.createElementVNode("view",{class:"card-body"},[e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"æœ€ååœ¨çº¿ï¼š"),e.createElementVNode("text",{class:"value"},e.toDisplayString(r.formatTime(t.last_time)),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"åºåˆ—å·ï¼š"),e.createElementVNode("text",{class:"value"},e.toDisplayString(t.sn),1)])]),e.createElementVNode("view",{class:"card-footer-simple"},[e.createElementVNode("text",{class:"arrow-text"},"æŸ¥çœ‹è¯¦æƒ… >")])],8,["onClick"])))),128))]),0!==o.devices.length||o.loading?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("image",{src:"/static/empty.png",mode:"aspectFit",class:"empty-img"}),e.createElementVNode("text",{class:"empty-text"},"è¯¥èŒ¶å›­æš‚æ— è®¾å¤‡")]))])])}],["__scopeId","data-v-c2b81f9e"]]);const y=m({data:()=>({gardenId:null,form:{name:"",description:"",address:"",image_path:""},saving:!1,showCoverSelector:!1}),computed:{coverUrl(){if(!this.form.image_path)return"/static/gardens/1.png";if(this.form.image_path.startsWith("http"))return this.form.image_path;return(this.$baseUrl||"")+this.form.image_path}},onLoad(e){e.id&&(this.gardenId=Number(e.id),this.loadData())},methods:{async loadData(){try{const e=await i(this.gardenId);this.form={name:e.name,description:e.description,address:e.address,image_path:e.image_path}}catch(e){uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}},selectSystemImage(e){this.form.image_path=`/static/gardens/${e}.png`,this.showCoverSelector=!1},chooseImage(){uni.chooseImage({count:1,success:async e=>{const t=e.tempFilePaths[0];try{uni.showLoading({title:"ä¸Šä¼ ä¸­"});const e=await n("/upload/file",t,"file");this.form.image_path=e.url||e.path,this.showCoverSelector=!1}catch(a){uni.showToast({title:"ä¸Šä¼ å¤±è´¥",icon:"none"})}finally{uni.hideLoading()}}})},async save(){this.saving=!0;try{await(e=this.gardenId,t=this.form,r(`/tea-gardens/${e}`,t)),uni.showToast({title:"ä¿å­˜æˆåŠŸ",icon:"success"}),setTimeout((()=>{const e=getCurrentPages(),t=e[e.length-2];t&&t.$vm.loadData&&t.$vm.loadData(),uni.navigateBack()}),1500)}catch(a){uni.showToast({title:"ä¿å­˜å¤±è´¥",icon:"none"})}finally{this.saving=!1}var e,t}}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"page-container"},[e.createElementVNode("view",{class:"title-lg header"},"ç¼–è¾‘èŒ¶å›­"),e.createElementVNode("view",{class:"card form-card"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"èŒ¶å›­åç§°"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[0]||(a[0]=e=>o.form.name=e),placeholder:"è¯·è¾“å…¥èŒ¶å›­åç§°"},null,512),[[e.vModelText,o.form.name]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"èŒ¶å›­å°é¢"),e.createElementVNode("view",{class:"cover-preview",onClick:a[1]||(a[1]=e=>o.showCoverSelector=!0)},[e.createElementVNode("image",{src:r.coverUrl,mode:"aspectFill",class:"cover-img"},null,8,["src"]),e.createElementVNode("view",{class:"cover-overlay"},[e.createElementVNode("text",{class:"overlay-text"},"æ›´æ¢å°é¢")])])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"ç®€ä»‹æè¿°"),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":a[2]||(a[2]=e=>o.form.description=e),placeholder:"è¯·è¾“å…¥èŒ¶å›­æè¿°"},null,512),[[e.vModelText,o.form.description]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"ç§æ¤åœ°å€"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[3]||(a[3]=e=>o.form.address=e),placeholder:"è¯·è¾“å…¥åœ°å€"},null,512),[[e.vModelText,o.form.address]])]),e.createElementVNode("button",{class:"btn-primary",onClick:a[4]||(a[4]=(...e)=>r.save&&r.save(...e)),loading:o.saving},"ä¿å­˜ä¿®æ”¹",8,["loading"])]),o.showCoverSelector?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-mask",onClick:a[8]||(a[8]=e=>o.showCoverSelector=!1)},[e.createElementVNode("view",{class:"modal-content",onClick:a[7]||(a[7]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"é€‰æ‹©å°é¢"),e.createElementVNode("text",{class:"close-btn",onClick:a[5]||(a[5]=e=>o.showCoverSelector=!1)},"Ã—")]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"grid-scroll"},[e.createElementVNode("view",{class:"cover-grid"},[e.createElementVNode("view",{class:"grid-item upload-item",onClick:a[6]||(a[6]=(...e)=>r.chooseImage&&r.chooseImage(...e))},[e.createElementVNode("text",{class:"upload-icon"},"+"),e.createElementVNode("text",{class:"upload-text"},"ä¸Šä¼ å›¾ç‰‡")]),(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(14,(a=>e.createElementVNode("view",{key:a,class:e.normalizeClass(["grid-item",{active:o.form.image_path===`/static/gardens/${a}.png`}]),onClick:e=>r.selectSystemImage(a)},[e.createElementVNode("image",{src:`${t.$baseUrl}/static/gardens/${a}.png`,mode:"aspectFill",class:"grid-img"},null,8,["src"]),o.form.image_path===`/static/gardens/${a}.png`?(e.openBlock(),e.createElementBlock("view",{key:0,class:"check-mark"},"âœ“")):e.createCommentVNode("",!0)],10,["onClick"]))),64))])])])])):e.createCommentVNode("",!0)])}],["__scopeId","data-v-64dac3f5"]]);const k=m({data:()=>({form:{username:"",password:""},loading:!1}),methods:{async handleLogin(){if(this.form.username&&this.form.password){this.loading=!0;try{const t=await(e=this.form,o("/auth/login",e));uni.setStorageSync("token",t.token),uni.setStorageSync("userInfo",t.userInfo),uni.setStorageSync("roles",t.userInfo.roles||[]),uni.showToast({title:"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout((()=>{uni.reLaunch({url:"/pages/index/index"})}),1500)}catch(t){uni.showToast({title:t.detail||"ç™»å½•å¤±è´¥",icon:"none"})}finally{this.loading=!1}var e}else uni.showToast({title:"è¯·è¾“å…¥è´¦å·å’Œå¯†ç ",icon:"none"})}}},[["render",function(t,a,s,l,o,r){return e.openBlock(),e.createElementBlock("view",{class:"login-container"},[e.createElementVNode("view",{class:"bg-circle circle-1"}),e.createElementVNode("view",{class:"bg-circle circle-2"}),e.createElementVNode("view",{class:"content-wrapper"},[e.createElementVNode("view",{class:"logo-area"},[e.createElementVNode("image",{src:"/static/logo.png",mode:"aspectFit",class:"logo animate-fade-in-down"}),e.createElementVNode("view",{class:"text-area animate-fade-in-up"},[e.createElementVNode("text",{class:"app-name"},"èŒ¶æ™ºäº‘"),e.createElementVNode("text",{class:"app-slogan"},"æ™ºæ…§èŒ¶å›­æ•°å­—å¤§è„‘")])]),e.createElementVNode("view",{class:"form-card animate-slide-up"},[e.createElementVNode("view",{class:"form-header"},[e.createElementVNode("text",{class:"welcome-text"},"æ¬¢è¿ç™»å½•")]),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("view",{class:"input-icon-wrapper"},[e.createElementVNode("text",{class:"icon-user"},"ğŸ‘¤")]),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[0]||(a[0]=e=>o.form.username=e),placeholder:"è¯·è¾“å…¥è´¦å·","placeholder-class":"input-placeholder"},null,512),[[e.vModelText,o.form.username]])]),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("view",{class:"input-icon-wrapper"},[e.createElementVNode("text",{class:"icon-lock"},"ğŸ”’")]),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[1]||(a[1]=e=>o.form.password=e),password:"",placeholder:"è¯·è¾“å…¥å¯†ç ","placeholder-class":"input-placeholder"},null,512),[[e.vModelText,o.form.password]])]),e.createElementVNode("button",{class:"btn-primary","hover-class":"btn-hover",onClick:a[2]||(a[2]=(...e)=>r.handleLogin&&r.handleLogin(...e)),loading:o.loading}," ç«‹å³è¿›å…¥ ",8,["loading"]),e.createElementVNode("view",{class:"footer-actions"},[e.createElementVNode("text",{class:"action-link"},"å¿˜è®°å¯†ç ?")])])]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("text",{class:"copyright"},"Tea Zhi Yun Â© 2025")])])}],["__scopeId","data-v-2db7ec4c"]]);__definePage("pages/index/index",p),__definePage("pages/alarm/index",u),__definePage("pages/plot/detail",g),__definePage("pages/disease/disease",h),__definePage("pages/chat/chat",v),__definePage("pages/assistant/index",w),__definePage("pages/profile/index",E),__definePage("pages/plot/edit",N),__definePage("pages/plot/index",V),__definePage("pages/plot/edit_garden",y),__definePage("pages/login/index",k);const f={onLaunch(){t("log","at App.vue:4","App Launch");uni.getStorageSync("token")||uni.reLaunch({url:"/pages/login/index"})},onShow(){t("log","at App.vue:15","App Show");var e;uni.getStorageSync("token")&&(e=()=>Promise.resolve().then((()=>d)),Promise.resolve().then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))).then((({getWeather:e})=>{e("ï¿½ï¿½ï¿½ï¿½").catch((e=>t("log","at App.vue:27","Prefetch failed",e)))}))},onHide(){t("log","at App.vue:32","App Hide")}};const{app:x,Vuex:S,Pinia:b}=function(){const t=e.createVueApp(f);return t.config.globalProperties.$baseUrl="http://127.0.0.1:8000",{app:t}}();uni.Vuex=S,uni.Pinia=b,x.provide("__globalStyles",__uniConfig.styles),x._component.mpType="app",x._component.render=()=>{},x.mount("#app")}(Vue);
