"use strict";const a=require("../../common/vendor.js"),t=require("../../api/dashboard.js"),e=require("../../api/garden.js"),s={data:()=>({stats:{garden_count:0,device_online_count:0,alarm_count:0},gardens:[],loading:!1,userName:"管理员"}),onShow(){const t=a.index.getStorageSync("userInfo");t&&(t.name||t.username)&&(this.userName=t.name||t.username),this.loadData()},onPullDownRefresh(){this.loadData()},methods:{async loadData(){this.loading=!0;try{const[s,n]=await Promise.all([t.getDashboardStats(),e.getGardenList({page:1,size:100})]);this.stats=s,this.gardens=n.list.map((a=>({...a,devices:a.totalCount||0,image:a.image_path?this.$baseUrl+a.image_path:"/static/default_garden.jpg",lastAlert:a.alarmCount>0?`${a.alarmCount}条告警待处理`:null})))}catch(s){console.error(s),a.index.showToast({title:"加载失败",icon:"none"})}finally{this.loading=!1,a.index.stopPullDownRefresh()}},goDetail(t){a.index.navigateTo({url:`/pages/plot/index?garden_id=${t}`})}}};const n=a._export_sfc(s,[["render",function(t,e,s,n,r,o){return{a:a.t(r.userName),b:a.t(r.stats.garden_count),c:a.t(r.stats.device_online_count),d:a.t(r.stats.alarm_count),e:r.stats.alarm_count>0?1:"",f:a.f(r.gardens,((t,e,s)=>a.e({a:t.image,b:a.t(t.name),c:a.t("normal"===t.status?"正常运行":"需关注"),d:a.n("normal"===t.status?"tag-primary":"tag-warn"),e:a.t(t.area),f:a.t(t.devices),g:t.lastAlert},t.lastAlert?{h:a.t(t.lastAlert)}:{},{i:t.id,j:a.o((a=>o.goDetail(t.id)),t.id)})))}}],["__scopeId","data-v-be33607f"]]);wx.createPage(n);
