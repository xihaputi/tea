"use strict";const e=require("../../common/vendor.js"),a=require("../../api/garden.js"),t=require("../../common/http.js"),o={data:()=>({gardenId:null,form:{name:"",description:"",address:"",image_path:""},saving:!1,showCoverSelector:!1}),computed:{coverUrl(){if(!this.form.image_path)return"/static/gardens/1.png";if(this.form.image_path.startsWith("http"))return this.form.image_path;return(this.$baseUrl||"")+this.form.image_path}},onLoad(e){e.id&&(this.gardenId=Number(e.id),this.loadData())},methods:{async loadData(){try{const e=await a.getGardenDetail(this.gardenId);this.form={name:e.name,description:e.description,address:e.address,image_path:e.image_path}}catch(t){e.index.showToast({title:"加载失败",icon:"none"})}},selectSystemImage(e){this.form.image_path=`/static/gardens/${e}.png`,this.showCoverSelector=!1},chooseImage(){e.index.chooseImage({count:1,success:async a=>{const o=a.tempFilePaths[0];try{e.index.showLoading({title:"上传中"});const a=await t.api.upload("/upload/file",o,"file");this.form.image_path=a.url||a.path,this.showCoverSelector=!1}catch(s){e.index.showToast({title:"上传失败",icon:"none"})}finally{e.index.hideLoading()}}})},async save(){this.saving=!0;try{await a.updateGarden(this.gardenId,this.form),e.index.showToast({title:"保存成功",icon:"success"}),setTimeout((()=>{const a=getCurrentPages(),t=a[a.length-2];t&&t.$vm.loadData&&t.$vm.loadData(),e.index.navigateBack()}),1500)}catch(t){e.index.showToast({title:"保存失败",icon:"none"})}finally{this.saving=!1}}}};const s=e._export_sfc(o,[["render",function(a,t,o,s,i,r){return e.e({a:i.form.name,b:e.o((e=>i.form.name=e.detail.value)),c:r.coverUrl,d:e.o((e=>i.showCoverSelector=!0)),e:i.form.description,f:e.o((e=>i.form.description=e.detail.value)),g:i.form.address,h:e.o((e=>i.form.address=e.detail.value)),i:e.o(((...e)=>r.save&&r.save(...e))),j:i.saving,k:i.showCoverSelector},i.showCoverSelector?{l:e.o((e=>i.showCoverSelector=!1)),m:e.o(((...e)=>r.chooseImage&&r.chooseImage(...e))),n:e.f(14,((t,o,s)=>e.e({a:`${a.$baseUrl}/static/gardens/${t}.png`,b:i.form.image_path===`/static/gardens/${t}.png`},(i.form.image_path,{}),{c:t,d:i.form.image_path===`/static/gardens/${t}.png`?1:"",e:e.o((e=>r.selectSystemImage(t)),t)}))),o:e.o((()=>{})),p:e.o((e=>i.showCoverSelector=!1))}:{})}],["__scopeId","data-v-64dac3f5"]]);wx.createPage(s);
