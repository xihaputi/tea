"use strict";const e=require("../../common/http.js"),t=require("../../common/vendor.js"),r={data:()=>({plotId:null,sensor:null,advice:null,loading:!1,error:""}),onLoad(e){this.plotId=Number(e.plot_id),this.refresh()},methods:{async refresh(){if(this.plotId){this.loading=!0,this.error="";try{const[t,r]=await Promise.all([e.api.get("/sensor/latest",{plot_id:this.plotId}),e.api.get("/advice/today",{plot_id:this.plotId})]);this.sensor=t,this.advice=r}catch(t){this.error="加载失败，请检查后端服务"}finally{this.loading=!1}}else this.error="未传递地块 ID"},formatTime:e=>e?e.replace("T"," ").replace("Z",""):"--",pillClass:e=>"optimal"===e?"pill-optimal":"water"===e?"pill-water":"drain"===e?"pill-drain":"pill-optimal",adviceText:e=>"optimal"===e?"适宜":"water"===e?"建议浇水":"drain"===e?"注意排水":e||"未知"}};const i=t._export_sfc(r,[["render",function(e,r,i,o,a,s){return t.e({a:t.t(a.plotId),b:a.error},a.error?{c:t.t(a.error)}:{},{d:a.loading},(a.loading,{}),{e:a.sensor},a.sensor?{f:t.t(s.formatTime(a.sensor.timestamp)),g:t.t(a.sensor.soil_moisture),h:t.t(a.sensor.temperature||"--"),i:t.t(a.sensor.humidity||"--")}:{},{j:a.advice},a.advice?{k:t.t(s.adviceText(a.advice.level)),l:t.n(s.pillClass(a.advice.level)),m:t.t(a.advice.advice),n:t.t(s.formatTime(a.advice.timestamp))}:{},{o:t.o(((...e)=>s.refresh&&s.refresh(...e)))})}],["__scopeId","data-v-c6b8a1fb"]]);wx.createPage(i);
