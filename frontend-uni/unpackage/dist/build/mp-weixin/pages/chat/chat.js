"use strict";const s=require("../../common/vendor.js"),o=require("../../api/chat.js"),t={data:()=>({question:"",history:[],sessionId:null,loading:!1}),onLoad(){this.loadHistory()},methods:{async loadHistory(){try{const s=await o.getLatestChat();s.session_id&&(this.sessionId=s.session_id,this.history=s.history||[],this.scrollToBottom())}catch(s){console.error("Failed to load history",s)}},async ask(){if(!this.question||this.loading)return;const s=this.question;this.question="",this.history.push({role:"user",content:s}),this.scrollToBottom(),this.loading=!0;try{const t=await o.askChatbot({question:s,history:this.history.map((s=>({role:s.role,content:s.content}))),session_id:this.sessionId});t.session_id&&(this.sessionId=t.session_id),this.history.push({role:"assistant",content:t.answer})}catch(t){this.history.push({role:"assistant",content:"抱歉，我现在无法回答，请稍后再试。"})}finally{this.loading=!1,this.scrollToBottom()}},scrollToBottom(){setTimeout((()=>{s.index.pageScrollTo({scrollTop:99999,duration:300})}),100)}}};const i=s._export_sfc(t,[["render",function(o,t,i,e,n,r){return s.e({a:s.f(n.history,((o,t,i)=>s.e({a:"assistant"===o.role},(o.role,{}),{b:s.t(o.content),c:s.n("user"===o.role?"bubble-user":"bubble-ai"),d:"user"===o.role},(o.role,{}),{e:t,f:s.n("user"===o.role?"msg-right":"msg-left")}))),b:n.loading},(n.loading,{}),{c:s.o(((...s)=>r.ask&&r.ask(...s))),d:n.question,e:s.o((s=>n.question=s.detail.value)),f:s.o(((...s)=>r.ask&&r.ask(...s))),g:!n.question||n.loading?1:""})}],["__scopeId","data-v-740f2877"]]);wx.createPage(i);
