{"version":3,"file":"chat.js","sources":["pages/chat/chat.vue","E:/EDGE‰∏ãËΩΩ/ÂéãÁº©Êñá‰ª∂/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2hhdC9jaGF0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"page-container chat-page\">\n    <view class=\"chat-list\">\n      <view class=\"system-msg\">\n        <text class=\"system-text\">AI Ëå∂ÂÜúÈ°æÈóÆ‰∏∫ÊÇ®ÊúçÂä°ÔºåËØ∑ÊèêÈóÆ</text>\n      </view>\n      \n      <view v-for=\"(msg, idx) in history\" :key=\"idx\" class=\"msg-row\" :class=\"msg.role === 'user' ? 'msg-right' : 'msg-left'\">\n        \n        <!-- AI Avatar -->\n        <view v-if=\"msg.role === 'assistant'\" class=\"avatar ai-avatar\">ü§ñ</view>\n        \n        <view class=\"bubble\" :class=\"msg.role === 'user' ? 'bubble-user' : 'bubble-ai'\">\n          <text class=\"msg-content\">{{ msg.content }}</text>\n        </view>\n        \n        <!-- User Avatar -->\n        <view v-if=\"msg.role === 'user'\" class=\"avatar user-avatar\">üë§</view>\n      </view>\n      \n      <!-- Loading Indicator -->\n      <view v-if=\"loading\" class=\"msg-row msg-left\">\n        <view class=\"avatar ai-avatar\">ü§ñ</view>\n        <view class=\"bubble bubble-ai\">\n          <text class=\"msg-content\">ÊÄùËÄÉ‰∏≠...</text>\n        </view>\n      </view>\n      \n      <!-- Spacer for bottom input -->\n      <view style=\"height: 120rpx\"></view>\n    </view>\n\n    <!-- Bottom Input Area -->\n    <view class=\"input-area\">\n      <view class=\"input-box\">\n        <input class=\"chat-input\" v-model=\"question\" placeholder=\"ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÈóÆÈ¢ò...\" @confirm=\"ask\" />\n        <view class=\"send-btn\" @click=\"ask\" :class=\"{ disabled: !question || loading }\">\n          <text class=\"send-icon\">‚Üë</text>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { askChatbot, getLatestChat } from '@/api/chat.js';\n\nexport default {\n  data() {\n    return {\n      question: '',\n      history: [],\n      sessionId: null,\n      loading: false,\n    };\n  },\n  onLoad() {\n    this.loadHistory();\n  },\n  methods: {\n    async loadHistory() {\n      try {\n        const res = await getLatestChat();\n        if (res.session_id) {\n          this.sessionId = res.session_id;\n          this.history = res.history || [];\n          this.scrollToBottom();\n        }\n      } catch (e) {\n        console.error('Failed to load history', e);\n      }\n    },\n    async ask() {\n      if (!this.question || this.loading) return;\n      \n      const content = this.question;\n      this.question = ''; // Clear immediately\n      \n      // Add user message\n      this.history.push({ role: 'user', content });\n      this.scrollToBottom();\n      \n      this.loading = true;\n      try {\n        const res = await askChatbot({\n          question: content,\n          history: this.history.map(m => ({ role: m.role, content: m.content })),\n          session_id: this.sessionId\n        });\n        \n        if (res.session_id) {\n          this.sessionId = res.session_id;\n        }\n        \n        this.history.push({ role: 'assistant', content: res.answer });\n      } catch (e) {\n        this.history.push({ role: 'assistant', content: 'Êä±Ê≠âÔºåÊàëÁé∞Âú®Êó†Ê≥ïÂõûÁ≠îÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ' });\n      } finally {\n        this.loading = false;\n        this.scrollToBottom();\n      }\n    },\n    scrollToBottom() {\n      setTimeout(() => {\n        uni.pageScrollTo({ scrollTop: 99999, duration: 300 });\n      }, 100);\n    }\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"@/uni.scss\";\n\n.chat-page {\n  padding: 24rpx;\n  background-color: $bg-page;\n  min-height: 100vh;\n}\n\n.system-msg {\n  text-align: center;\n  margin: 24rpx 0;\n}\n\n.system-text {\n  font-size: 24rpx;\n  color: #9CA3AF;\n  background: rgba(0,0,0,0.05);\n  padding: 8rpx 24rpx;\n  border-radius: 999rpx;\n}\n\n.msg-row {\n  display: flex;\n  margin-bottom: 32rpx;\n  align-items: flex-start;\n  \n  &.msg-right {\n    justify-content: flex-end;\n  }\n}\n\n.avatar {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 40rpx;\n  flex-shrink: 0;\n  \n  &.ai-avatar {\n    background: #E0E7FF;\n    margin-right: 16rpx;\n  }\n  \n  &.user-avatar {\n    background: $primary-light;\n    margin-left: 16rpx;\n  }\n}\n\n.bubble {\n  max-width: 60%;\n  padding: 24rpx;\n  border-radius: 20rpx;\n  font-size: 30rpx;\n  line-height: 1.5;\n  position: relative;\n  \n  &.bubble-ai {\n    background: #fff;\n    color: $text-main;\n    border-top-left-radius: 4rpx;\n    box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.05);\n  }\n  \n  &.bubble-user {\n    background: $primary;\n    color: #fff;\n    border-top-right-radius: 4rpx;\n    box-shadow: 0 2rpx 8rpx rgba(16, 185, 129, 0.2);\n  }\n}\n\n/* Bottom Input Area */\n.input-area {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  background: #fff;\n  padding: 24rpx;\n  padding-bottom: calc(24rpx + constant(safe-area-inset-bottom));\n  padding-bottom: calc(24rpx + env(safe-area-inset-bottom));\n  box-shadow: 0 -4rpx 16rpx rgba(0,0,0,0.05);\n}\n\n.input-box {\n  display: flex;\n  align-items: center;\n  background: #F3F4F6;\n  border-radius: 40rpx;\n  padding: 12rpx 12rpx 12rpx 32rpx;\n}\n\n.chat-input {\n  flex: 1;\n  height: 72rpx;\n  font-size: 30rpx;\n  color: $text-main;\n}\n\n.send-btn {\n  width: 72rpx;\n  height: 72rpx;\n  background: $primary;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 16rpx;\n  transition: all 0.2s;\n  \n  &.disabled {\n    background: #D1D5DB;\n    opacity: 0.8;\n  }\n  \n  &:active:not(.disabled) {\n    transform: scale(0.9);\n  }\n}\n\n.send-icon {\n  color: #fff;\n  font-size: 32rpx;\n  font-weight: 700;\n}\n</style>\n","import MiniProgramPage from 'D:/thingsboard_envor/tea/frontend-uni/pages/chat/chat.vue'\nwx.createPage(MiniProgramPage)"],"names":["getLatestChat","uni","askChatbot"],"mappings":";;;AA+CA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,MACV,SAAS,CAAE;AAAA,MACX,WAAW;AAAA,MACX,SAAS;AAAA;EAEZ;AAAA,EACD,SAAS;AACP,SAAK,YAAW;AAAA,EACjB;AAAA,EACD,SAAS;AAAA,IACP,MAAM,cAAc;AAClB,UAAI;AACF,cAAM,MAAM,MAAMA,SAAAA;AAClB,YAAI,IAAI,YAAY;AAClB,eAAK,YAAY,IAAI;AACrB,eAAK,UAAU,IAAI,WAAW,CAAA;AAC9B,eAAK,eAAc;AAAA,QACrB;AAAA,MACF,SAAS,GAAG;AACVC,sBAAA,MAAA,MAAA,SAAA,6BAAc,0BAA0B,CAAC;AAAA,MAC3C;AAAA,IACD;AAAA,IACD,MAAM,MAAM;AACV,UAAI,CAAC,KAAK,YAAY,KAAK;AAAS;AAEpC,YAAM,UAAU,KAAK;AACrB,WAAK,WAAW;AAGhB,WAAK,QAAQ,KAAK,EAAE,MAAM,QAAQ,QAAM,CAAG;AAC3C,WAAK,eAAc;AAEnB,WAAK,UAAU;AACf,UAAI;AACF,cAAM,MAAM,MAAMC,oBAAW;AAAA,UAC3B,UAAU;AAAA,UACV,SAAS,KAAK,QAAQ,IAAI,QAAM,EAAE,MAAM,EAAE,MAAM,SAAS,EAAE,QAAS,EAAC;AAAA,UACrE,YAAY,KAAK;AAAA,QACnB,CAAC;AAED,YAAI,IAAI,YAAY;AAClB,eAAK,YAAY,IAAI;AAAA,QACvB;AAEA,aAAK,QAAQ,KAAK,EAAE,MAAM,aAAa,SAAS,IAAI,OAAO,CAAC;AAAA,MAC9D,SAAS,GAAG;AACV,aAAK,QAAQ,KAAK,EAAE,MAAM,aAAa,SAAS,oBAAkB,CAAG;AAAA,MACvE,UAAU;AACR,aAAK,UAAU;AACf,aAAK,eAAc;AAAA,MACrB;AAAA,IACD;AAAA,IACD,iBAAiB;AACf,iBAAW,MAAM;AACfD,sBAAG,MAAC,aAAa,EAAE,WAAW,OAAO,UAAU,IAAI,CAAC;AAAA,MACrD,GAAE,GAAG;AAAA,IACR;AAAA,EACD;AACH;;;;;;;;;;;;;;;;;;;;;;;;;AC3GA,GAAG,WAAW,eAAe;"}