{"version":3,"file":"edit_garden.js","sources":["pages/plot/edit_garden.vue","E:/EDGE下载/压缩文件/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGxvdC9lZGl0X2dhcmRlbi52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page-container\">\r\n    <view class=\"title-lg header\">编辑茶园</view>\r\n    \r\n    <view class=\"card form-card\">\r\n      <view class=\"form-item\">\r\n        <text class=\"label\">茶园名称</text>\r\n        <input class=\"input\" v-model=\"form.name\" placeholder=\"请输入茶园名称\" />\r\n      </view>\r\n      \r\n      <view class=\"form-item\">\r\n        <text class=\"label\">茶园封面</text>\r\n        <view class=\"cover-preview\" @click=\"showCoverSelector = true\">\r\n          <image :src=\"coverUrl\" mode=\"aspectFill\" class=\"cover-img\"></image>\r\n          <view class=\"cover-overlay\">\r\n            <text class=\"overlay-text\">更换封面</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      \r\n      <view class=\"form-item\">\r\n        <text class=\"label\">简介描述</text>\r\n        <textarea class=\"textarea\" v-model=\"form.description\" placeholder=\"请输入茶园描述\" />\r\n      </view>\r\n\r\n      <view class=\"form-item\">\r\n        <text class=\"label\">种植地址</text>\r\n        <input class=\"input\" v-model=\"form.address\" placeholder=\"请输入地址\" />\r\n      </view>\r\n\r\n      <button class=\"btn-primary\" @click=\"save\" :loading=\"saving\">保存修改</button>\r\n    </view>\r\n\r\n    <!-- Cover Selection Modal -->\r\n    <view v-if=\"showCoverSelector\" class=\"modal-mask\" @click=\"showCoverSelector = false\">\r\n      <view class=\"modal-content\" @click.stop>\r\n        <view class=\"modal-header\">\r\n          <text class=\"modal-title\">选择封面</text>\r\n          <text class=\"close-btn\" @click=\"showCoverSelector = false\">×</text>\r\n        </view>\r\n        \r\n        <scroll-view scroll-y class=\"grid-scroll\">\r\n          <view class=\"cover-grid\">\r\n            <!-- Custom Upload -->\r\n            <view class=\"grid-item upload-item\" @click=\"chooseImage\">\r\n              <text class=\"upload-icon\">+</text>\r\n              <text class=\"upload-text\">上传图片</text>\r\n            </view>\r\n            \r\n            <!-- System Images -->\r\n            <view \r\n              v-for=\"i in 14\" \r\n              :key=\"i\" \r\n              class=\"grid-item\" \r\n              :class=\"{ active: form.image_path === `/static/gardens/${i}.png` }\"\r\n              @click=\"selectSystemImage(i)\"\r\n            >\r\n              <image :src=\"`${$baseUrl}/static/gardens/${i}.png`\" mode=\"aspectFill\" class=\"grid-img\"></image>\r\n              <view v-if=\"form.image_path === `/static/gardens/${i}.png`\" class=\"check-mark\">✓</view>\r\n            </view>\r\n          </view>\r\n        </scroll-view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { getGardenDetail, updateGarden } from '@/api/garden.js';\r\nimport { api } from '@/common/http.js';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      gardenId: null,\r\n      form: {\r\n        name: '',\r\n        description: '',\r\n        address: '',\r\n        image_path: ''\r\n      },\r\n      saving: false,\r\n      showCoverSelector: false\r\n    };\r\n  },\r\n  computed: {\r\n    coverUrl() {\r\n      if (!this.form.image_path) return '/static/gardens/1.png'; // Default fallback\r\n      if (this.form.image_path.startsWith('http')) return this.form.image_path;\r\n      // Ensure baseUrl doesn't have double slash if image_path has one\r\n      const base = this.$baseUrl || ''; // Ensure base is defined\r\n      return base + this.form.image_path;\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    if (options.id) {\r\n      this.gardenId = Number(options.id);\r\n      this.loadData();\r\n    }\r\n  },\r\n  methods: {\r\n    async loadData() {\r\n      try {\r\n        const res = await getGardenDetail(this.gardenId);\r\n        this.form = {\r\n          name: res.name,\r\n          description: res.description,\r\n          address: res.address,\r\n          image_path: res.image_path\r\n        };\r\n      } catch (e) {\r\n        uni.showToast({ title: '加载失败', icon: 'none' });\r\n      }\r\n    },\r\n    selectSystemImage(index) {\r\n      this.form.image_path = `/static/gardens/${index}.png`;\r\n      this.showCoverSelector = false;\r\n    },\r\n    chooseImage() {\r\n      uni.chooseImage({\r\n        count: 1,\r\n        success: async (res) => {\r\n          const filePath = res.tempFilePaths[0];\r\n          try {\r\n            uni.showLoading({ title: '上传中' });\r\n            // Using the /disease/detect endpoint as a known working upload (hacky but functional for now if no generic upload)\r\n            // OR better: use the generic upload if backend supports it.\r\n            // Let's assume there is NO generic upload yet based on previous file list.\r\n            // I'll stick to a placeholder/local path for now OR try /common/upload if I saw it?\r\n            // I saw `upload.py` in routers! Let's check that.\r\n            // For now, assume /upload/file exists or fallback.\r\n             const uploadRes = await api.upload('/upload/file', filePath, 'file');\r\n             this.form.image_path = uploadRes.url || uploadRes.path;\r\n             this.showCoverSelector = false;\r\n          } catch (e) {\r\n            // uni.showToast({ title: '暂时不支持上传', icon: 'none' });\r\n             // Fallback: just use local path for display (won't persist well across devices but good for demo)\r\n             // this.form.image_path = filePath;\r\n             // this.showCoverSelector = false;\r\n             uni.showToast({ title: '上传失败', icon: 'none' });\r\n          } finally {\r\n            uni.hideLoading();\r\n          }\r\n        }\r\n      });\r\n    },\r\n    async save() {\r\n      this.saving = true;\r\n      try {\r\n        await updateGarden(this.gardenId, this.form);\r\n        uni.showToast({ title: '保存成功', icon: 'success' });\r\n        setTimeout(() => {\r\n          // Go back and refresh\r\n          const pages = getCurrentPages();\r\n          const prevPage = pages[pages.length - 2];\r\n          if (prevPage && prevPage.$vm.loadData) {\r\n              prevPage.$vm.loadData();\r\n          }\r\n          uni.navigateBack();\r\n        }, 1500);\r\n      } catch (e) {\r\n        uni.showToast({ title: '保存失败', icon: 'none' });\r\n      } finally {\r\n        this.saving = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import \"@/uni.scss\";\r\n\r\n.page-container {\r\n  padding: 24rpx;\r\n}\r\n\r\n.header {\r\n  margin-bottom: 24rpx;\r\n}\r\n\r\n.form-card {\r\n  padding: 32rpx;\r\n}\r\n\r\n.form-item {\r\n  margin-bottom: 32rpx;\r\n}\r\n\r\n.label {\r\n  display: block;\r\n  font-size: 28rpx;\r\n  color: $text-sub;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.input {\r\n  background: #F9FAFB;\r\n  border: 2rpx solid #E5E7EB;\r\n  border-radius: 12rpx;\r\n  padding: 20rpx;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.textarea {\r\n  background: #F9FAFB;\r\n  border: 2rpx solid #E5E7EB;\r\n  border-radius: 12rpx;\r\n  padding: 20rpx;\r\n  font-size: 28rpx;\r\n  width: 100%;\r\n  height: 160rpx;\r\n}\r\n\r\n.cover-preview {\r\n  width: 100%;\r\n  height: 300rpx;\r\n  border-radius: 16rpx;\r\n  overflow: hidden;\r\n  position: relative;\r\n  border: 2rpx solid #E5E7EB;\r\n}\r\n\r\n.cover-img {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.cover-overlay {\r\n  position: absolute;\r\n  top: 0; \r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0,0,0,0.3);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.overlay-text {\r\n  color: #fff;\r\n  border: 2rpx solid #fff;\r\n  padding: 8rpx 24rpx;\r\n  border-radius: 99rpx;\r\n  font-size: 26rpx;\r\n}\r\n\r\n/* Modal */\r\n.modal-mask {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0,0,0,0.5);\r\n  z-index: 999;\r\n  display: flex;\r\n  align-items: flex-end;\r\n}\r\n\r\n.modal-content {\r\n  background: #fff;\r\n  width: 100%;\r\n  border-radius: 24rpx 24rpx 0 0;\r\n  padding: 32rpx;\r\n  max-height: 80vh;\r\n}\r\n\r\n.modal-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 32rpx;\r\n}\r\n\r\n.modal-title {\r\n  font-size: 32rpx;\r\n  font-weight: 700;\r\n}\r\n\r\n.close-btn {\r\n  font-size: 40rpx;\r\n  color: $text-sub;\r\n  padding: 0 16rpx;\r\n}\r\n\r\n.grid-scroll {\r\n  height: 600rpx;\r\n}\r\n\r\n.cover-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(3, 1fr);\r\n  gap: 16rpx;\r\n}\r\n\r\n.grid-item {\r\n  aspect-ratio: 16/9;\r\n  border-radius: 12rpx;\r\n  overflow: hidden;\r\n  position: relative;\r\n  border: 4rpx solid transparent;\r\n  \r\n  &.active {\r\n    border-color: $primary;\r\n  }\r\n}\r\n\r\n.upload-item {\r\n  background: #F3F4F6;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border: 2rpx dashed #D1D5DB;\r\n}\r\n\r\n.upload-icon {\r\n  font-size: 48rpx;\r\n  color: $text-sub;\r\n}\r\n\r\n.upload-text {\r\n  font-size: 24rpx;\r\n  color: $text-sub;\r\n}\r\n\r\n.grid-img {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.check-mark {\r\n  position: absolute;\r\n  top: 8rpx;\r\n  right: 8rpx;\r\n  background: $primary;\r\n  color: #fff;\r\n  width: 32rpx;\r\n  height: 32rpx;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 20rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/thingsboard_envor/tea/frontend-uni/pages/plot/edit_garden.vue'\nwx.createPage(MiniProgramPage)"],"names":["getGardenDetail","uni","api","updateGarden"],"mappings":";;;;AAuEA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,MACV,MAAM;AAAA,QACJ,MAAM;AAAA,QACN,aAAa;AAAA,QACb,SAAS;AAAA,QACT,YAAY;AAAA,MACb;AAAA,MACD,QAAQ;AAAA,MACR,mBAAmB;AAAA;EAEtB;AAAA,EACD,UAAU;AAAA,IACR,WAAW;AACT,UAAI,CAAC,KAAK,KAAK;AAAY,eAAO;AAClC,UAAI,KAAK,KAAK,WAAW,WAAW,MAAM;AAAG,eAAO,KAAK,KAAK;AAE9D,YAAM,OAAO,KAAK,YAAY;AAC9B,aAAO,OAAO,KAAK,KAAK;AAAA,IAC1B;AAAA,EACD;AAAA,EACD,OAAO,SAAS;AACd,QAAI,QAAQ,IAAI;AACd,WAAK,WAAW,OAAO,QAAQ,EAAE;AACjC,WAAK,SAAQ;AAAA,IACf;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,MAAM,WAAW;AACf,UAAI;AACF,cAAM,MAAM,MAAMA,WAAAA,gBAAgB,KAAK,QAAQ;AAC/C,aAAK,OAAO;AAAA,UACV,MAAM,IAAI;AAAA,UACV,aAAa,IAAI;AAAA,UACjB,SAAS,IAAI;AAAA,UACb,YAAY,IAAI;AAAA;MAEpB,SAAS,GAAG;AACVC,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MAC/C;AAAA,IACD;AAAA,IACD,kBAAkB,OAAO;AACvB,WAAK,KAAK,aAAa,mBAAmB,KAAK;AAC/C,WAAK,oBAAoB;AAAA,IAC1B;AAAA,IACD,cAAc;AACZA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,SAAS,OAAO,QAAQ;AACtB,gBAAM,WAAW,IAAI,cAAc,CAAC;AACpC,cAAI;AACFA,0BAAAA,MAAI,YAAY,EAAE,OAAO,MAAO,CAAA;AAO/B,kBAAM,YAAY,MAAMC,gBAAI,OAAO,gBAAgB,UAAU,MAAM;AACnE,iBAAK,KAAK,aAAa,UAAU,OAAO,UAAU;AAClD,iBAAK,oBAAoB;AAAA,UAC5B,SAAS,GAAG;AAKTD,0BAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,UAChD,UAAU;AACRA,0BAAG,MAAC,YAAW;AAAA,UACjB;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACF;AAAA,IACD,MAAM,OAAO;AACX,WAAK,SAAS;AACd,UAAI;AACF,cAAME,WAAY,aAAC,KAAK,UAAU,KAAK,IAAI;AAC3CF,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAQ,CAAG;AAChD,mBAAW,MAAM;AAEf,gBAAM,QAAQ;AACd,gBAAM,WAAW,MAAM,MAAM,SAAS,CAAC;AACvC,cAAI,YAAY,SAAS,IAAI,UAAU;AACnC,qBAAS,IAAI;UACjB;AACAA,wBAAG,MAAC,aAAY;AAAA,QACjB,GAAE,IAAI;AAAA,MACT,SAAS,GAAG;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MAC/C,UAAU;AACR,aAAK,SAAS;AAAA,MAChB;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtKA,GAAG,WAAW,eAAe;"}