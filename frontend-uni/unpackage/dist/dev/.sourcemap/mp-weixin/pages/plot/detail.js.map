{"version":3,"file":"detail.js","sources":["pages/plot/detail.vue","E:/EDGE下载/压缩文件/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGxvdC9kZXRhaWwudnVl"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view class=\"title\" style=\"padding: 24rpx 24rpx 8rpx\">地块详情</view>\n    <view class=\"subtitle\" style=\"padding: 0 24rpx 16rpx\">编号 {{ plotId }}</view>\n\n    <view v-if=\"error\" class=\"card\" style=\"color: #ef4444\">{{ error }}</view>\n    <view v-if=\"loading\" class=\"card\">加载中...</view>\n\n    <view v-if=\"sensor\" class=\"card\">\n      <view class=\"title\">环境数据</view>\n      <view class=\"subtitle\">最近记录：{{ formatTime(sensor.timestamp) }}</view>\n      <view style=\"margin-top: 12rpx\">\n        <view>土壤湿度：{{ sensor.soil_moisture }}%</view>\n        <view>气温：{{ sensor.temperature || '--' }} ℃</view>\n        <view>湿度：{{ sensor.humidity || '--' }} %</view>\n      </view>\n    </view>\n\n    <view v-if=\"advice\" class=\"card\">\n      <view class=\"title\">今日建议</view>\n      <view class=\"subtitle\">基于最新土壤湿度</view>\n      <view style=\"margin: 12rpx 0\">\n        <text class=\"pill\" :class=\"pillClass(advice.level)\">{{ adviceText(advice.level) }}</text>\n      </view>\n      <view>{{ advice.advice }}</view>\n      <view class=\"subtitle\" style=\"margin-top: 12rpx\">{{ formatTime(advice.timestamp) }}</view>\n    </view>\n\n    <view class=\"card\">\n      <view class=\"btn-primary\" @click=\"refresh\">刷新数据</view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { api } from '../../common/http.js';\n\nexport default {\n  data() {\n    return {\n      plotId: null,\n      sensor: null,\n      advice: null,\n      loading: false,\n      error: '',\n    };\n  },\n  onLoad(options) {\n    this.plotId = Number(options.plot_id);\n    this.refresh();\n  },\n  methods: {\n    async refresh() {\n      if (!this.plotId) {\n        this.error = '未传递地块 ID';\n        return;\n      }\n      this.loading = true;\n      this.error = '';\n      try {\n        const [sensor, advice] = await Promise.all([\n          api.get('/sensor/latest', { plot_id: this.plotId }),\n          api.get('/advice/today', { plot_id: this.plotId }),\n        ]);\n        this.sensor = sensor;\n        this.advice = advice;\n      } catch (e) {\n        this.error = '加载失败，请检查后端服务';\n      } finally {\n        this.loading = false;\n      }\n    },\n    formatTime(ts) {\n      if (!ts) return '--';\n      return ts.replace('T', ' ').replace('Z', '');\n    },\n    pillClass(level) {\n      if (level === 'optimal') return 'pill-optimal';\n      if (level === 'water') return 'pill-water';\n      if (level === 'drain') return 'pill-drain';\n      return 'pill-optimal';\n    },\n    adviceText(level) {\n      if (level === 'optimal') return '适宜';\n      if (level === 'water') return '建议浇水';\n      if (level === 'drain') return '注意排水';\n      return level || '未知';\n    },\n  },\n};\n</script>\n\n<style scoped>\n.page {\n  padding: 16rpx 20rpx 40rpx;\n}\n</style>\n","import MiniProgramPage from 'D:/thingsboard_envor/tea/frontend-uni/pages/plot/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["api"],"mappings":";;;AAqCA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,OAAO;AAAA;EAEV;AAAA,EACD,OAAO,SAAS;AACd,SAAK,SAAS,OAAO,QAAQ,OAAO;AACpC,SAAK,QAAO;AAAA,EACb;AAAA,EACD,SAAS;AAAA,IACP,MAAM,UAAU;AACd,UAAI,CAAC,KAAK,QAAQ;AAChB,aAAK,QAAQ;AACb;AAAA,MACF;AACA,WAAK,UAAU;AACf,WAAK,QAAQ;AACb,UAAI;AACF,cAAM,CAAC,QAAQ,MAAM,IAAI,MAAM,QAAQ,IAAI;AAAA,UACzCA,YAAG,IAAC,IAAI,kBAAkB,EAAE,SAAS,KAAK,QAAQ;AAAA,UAClDA,YAAG,IAAC,IAAI,iBAAiB,EAAE,SAAS,KAAK,QAAQ;AAAA,QACnD,CAAC;AACD,aAAK,SAAS;AACd,aAAK,SAAS;AAAA,MAChB,SAAS,GAAG;AACV,aAAK,QAAQ;AAAA,MACf,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA,IACD,WAAW,IAAI;AACb,UAAI,CAAC;AAAI,eAAO;AAChB,aAAO,GAAG,QAAQ,KAAK,GAAG,EAAE,QAAQ,KAAK,EAAE;AAAA,IAC5C;AAAA,IACD,UAAU,OAAO;AACf,UAAI,UAAU;AAAW,eAAO;AAChC,UAAI,UAAU;AAAS,eAAO;AAC9B,UAAI,UAAU;AAAS,eAAO;AAC9B,aAAO;AAAA,IACR;AAAA,IACD,WAAW,OAAO;AAChB,UAAI,UAAU;AAAW,eAAO;AAChC,UAAI,UAAU;AAAS,eAAO;AAC9B,UAAI,UAAU;AAAS,eAAO;AAC9B,aAAO,SAAS;AAAA,IACjB;AAAA,EACF;AACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxFA,GAAG,WAAW,eAAe;"}