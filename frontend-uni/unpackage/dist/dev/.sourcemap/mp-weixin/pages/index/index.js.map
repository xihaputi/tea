{"version":3,"file":"index.js","sources":["pages/index/index.vue","E:/EDGE下载/压缩文件/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"page-container\">\n    <!-- Top Header -->\n    <view class=\"dashboard-header\">\n      <view class=\"header-content\">\n        <text class=\"greeting\">早上好，{{ userName }}</text>\n        <text class=\"title-lg text-white\">茶园总览</text>\n      </view>\n      <view class=\"weather-widget\">\n        <text class=\"weather-temp\">24°C</text>\n        <text class=\"weather-desc\">多云</text>\n      </view>\n    </view>\n\n    <!-- Stats Grid -->\n    <view class=\"stats-grid\">\n      <view class=\"stat-card\">\n        <text class=\"stat-val\">{{ stats.garden_count }}</text>\n        <text class=\"stat-label\">茶园总数</text>\n      </view>\n      <view class=\"stat-card\">\n        <text class=\"stat-val\">{{ stats.device_online_count }}</text>\n        <text class=\"stat-label\">设备在线</text>\n      </view>\n      <view class=\"stat-card\" :class=\"{ warning: stats.alarm_count > 0 }\">\n        <text class=\"stat-val\">{{ stats.alarm_count }}</text>\n        <text class=\"stat-label\">当前告警</text>\n      </view>\n    </view>\n\n    <!-- Garden List -->\n    <view class=\"section-title\">\n      <text class=\"title-md\">我的茶园</text>\n      <text class=\"text-sub\">全部 ></text>\n    </view>\n\n    <view class=\"garden-list\">\n      <view v-for=\"item in gardens\" :key=\"item.id\" class=\"card garden-card\" @click=\"goDetail(item.id)\">\n        <image class=\"garden-cover\" :src=\"item.image\" mode=\"aspectFill\"></image>\n        <view class=\"garden-info\">\n          <view class=\"info-header\">\n            <text class=\"garden-name\">{{ item.name }}</text>\n            <view class=\"tag\" :class=\"item.status === 'normal' ? 'tag-primary' : 'tag-warn'\">\n              {{ item.status === 'normal' ? '正常运行' : '需关注' }}\n            </view>\n          </view>\n          \n          <view class=\"info-metrics\">\n            <view class=\"metric-item\">\n              <text class=\"metric-val\">{{ item.area }}亩</text>\n              <text class=\"metric-label\">面积</text>\n            </view>\n            <view class=\"metric-divider\"></view>\n            <view class=\"metric-item\">\n              <text class=\"metric-val\">{{ item.devices }}台</text>\n              <text class=\"metric-label\">设备</text>\n            </view>\n          </view>\n          \n          <view v-if=\"item.lastAlert\" class=\"alert-preview\">\n            <text class=\"alert-icon\">⚠️</text>\n            <text class=\"alert-text\">{{ item.lastAlert }}</text>\n          </view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { getDashboardStats } from '@/api/dashboard.js';\nimport { getGardenList } from '@/api/garden.js';\n\nexport default {\n  data() {\n    return {\n      stats: {\n        garden_count: 0,\n        device_online_count: 0,\n        alarm_count: 0\n      },\n      gardens: [],\n      loading: false,\n      userName: '管理员'\n    };\n  },\n  onShow() {\n      const userInfo = uni.getStorageSync('userInfo');\n      if (userInfo && (userInfo.name || userInfo.username)) {\n          this.userName = userInfo.name || userInfo.username;\n      }\n      this.loadData();\n  },\n  onPullDownRefresh() {\n    this.loadData();\n  },\n  methods: {\n    async loadData() {\n      this.loading = true;\n      try {\n        const [statsRes, gardensRes] = await Promise.all([\n          getDashboardStats(),\n          getGardenList({ page: 1, size: 100 })\n        ]);\n        \n        this.stats = statsRes;\n        this.gardens = gardensRes.list.map(item => ({\n          ...item,\n          devices: item.totalCount || 0,\n          image: item.image_path ? (this.$baseUrl + item.image_path) : '/static/default_garden.jpg', // Handle image path\n          lastAlert: item.alarmCount > 0 ? `${item.alarmCount}条告警待处理` : null\n        }));\n        \n      } catch (e) {\n        console.error(e);\n        uni.showToast({ title: '加载失败', icon: 'none' });\n      } finally {\n        this.loading = false;\n        uni.stopPullDownRefresh();\n      }\n    },\n    goDetail(id) {\n      // Navigate to Garden Detail (Plot List)\n      uni.navigateTo({ url: `/pages/plot/index?garden_id=${id}` });\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"@/uni.scss\";\n\n.dashboard-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 32rpx;\n}\n\n.greeting {\n  font-size: 24rpx;\n  color: $text-sub;\n  margin-bottom: 8rpx;\n  display: block;\n}\n\n.weather-widget {\n  text-align: right;\n}\n\n.weather-temp {\n  font-size: 36rpx;\n  font-weight: 700;\n  color: $primary;\n  display: block;\n}\n\n.weather-desc {\n  font-size: 24rpx;\n  color: $text-sub;\n}\n\n.stats-grid {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 20rpx;\n  margin-bottom: 40rpx;\n}\n\n.stat-card {\n  background: #fff;\n  padding: 24rpx;\n  border-radius: 20rpx;\n  text-align: center;\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.03);\n  \n  &.warning {\n    background: #FEF3C7;\n    .stat-val { color: #D97706; }\n  }\n}\n\n.stat-val {\n  display: block;\n  font-size: 40rpx;\n  font-weight: 700;\n  color: $text-main;\n  margin-bottom: 8rpx;\n}\n\n.stat-label {\n  font-size: 24rpx;\n  color: $text-sub;\n}\n\n.section-title {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 24rpx;\n}\n\n.garden-card {\n  padding: 0; // Reset default padding\n  overflow: hidden;\n}\n\n.garden-cover {\n  width: 100%;\n  height: 240rpx;\n  background-color: #E5E7EB;\n}\n\n.garden-info {\n  padding: 24rpx;\n}\n\n.info-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 24rpx;\n}\n\n.garden-name {\n  font-size: 32rpx;\n  font-weight: 700;\n  color: $text-main;\n}\n\n.info-metrics {\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  margin-bottom: 24rpx;\n}\n\n.metric-item {\n  text-align: center;\n}\n\n.metric-val {\n  display: block;\n  font-size: 28rpx;\n  font-weight: 600;\n  color: $text-main;\n}\n\n.metric-label {\n  font-size: 22rpx;\n  color: $text-sub;\n}\n\n.metric-divider {\n  width: 2rpx;\n  height: 24rpx;\n  background: #E5E7EB;\n}\n\n.alert-preview {\n  background: #FEF2F2;\n  padding: 16rpx;\n  border-radius: 12rpx;\n  display: flex;\n  align-items: center;\n  gap: 12rpx;\n}\n\n.alert-icon {\n  font-size: 24rpx;\n}\n\n.alert-text {\n  font-size: 24rpx;\n  color: #DC2626;\n}\n</style>\n","import MiniProgramPage from 'D:/thingsboard_envor/tea/frontend-uni/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getDashboardStats","getGardenList"],"mappings":";;;;AAyEA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,OAAO;AAAA,QACL,cAAc;AAAA,QACd,qBAAqB;AAAA,QACrB,aAAa;AAAA,MACd;AAAA,MACD,SAAS,CAAE;AAAA,MACX,SAAS;AAAA,MACT,UAAU;AAAA;EAEb;AAAA,EACD,SAAS;AACL,UAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC9C,QAAI,aAAa,SAAS,QAAQ,SAAS,WAAW;AAClD,WAAK,WAAW,SAAS,QAAQ,SAAS;AAAA,IAC9C;AACA,SAAK,SAAQ;AAAA,EAChB;AAAA,EACD,oBAAoB;AAClB,SAAK,SAAQ;AAAA,EACd;AAAA,EACD,SAAS;AAAA,IACP,MAAM,WAAW;AACf,WAAK,UAAU;AACf,UAAI;AACF,cAAM,CAAC,UAAU,UAAU,IAAI,MAAM,QAAQ,IAAI;AAAA,UAC/CC,gCAAmB;AAAA,UACnBC,WAAAA,cAAc,EAAE,MAAM,GAAG,MAAM,KAAK;AAAA,QACtC,CAAC;AAED,aAAK,QAAQ;AACb,aAAK,UAAU,WAAW,KAAK,IAAI,WAAS;AAAA,UAC1C,GAAG;AAAA,UACH,SAAS,KAAK,cAAc;AAAA,UAC5B,OAAO,KAAK,aAAc,KAAK,WAAW,KAAK,aAAc;AAAA;AAAA,UAC7D,WAAW,KAAK,aAAa,IAAI,GAAG,KAAK,UAAU,WAAW;AAAA,QAC/D,EAAC;AAAA,MAEJ,SAAS,GAAG;AACVF,sBAAAA,MAAA,MAAA,SAAA,gCAAc,CAAC;AACfA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MAC/C,UAAU;AACR,aAAK,UAAU;AACfA,sBAAG,MAAC,oBAAmB;AAAA,MACzB;AAAA,IACD;AAAA,IACD,SAAS,IAAI;AAEXA,oBAAG,MAAC,WAAW,EAAE,KAAK,+BAA+B,EAAE,GAAG,CAAC;AAAA,IAC7D;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7HA,GAAG,WAAW,eAAe;"}