import{r as e,o as t,c as a,w as l,a as n,b as o,T as r,d as s,E as i,u as d,e as c,f as u,g as m,h as p,i as f,j as _,k as h,v,l as g,m as y,n as x,p as b,t as E,s as k,q as A,x as w,F as L,y as I,z as j,A as O,B as P,C as q,D as C,G as T,H as V,I as D,J as R,K as S,L as z,M as N,N as $}from"./vendor.da7b8729.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const B={};B.render=function(s,i){const d=e("router-view");return t(),a(d,null,{default:l((({Component:e})=>[n(r,{name:"fade-slide",mode:"out-in"},{default:l((()=>[(t(),a(o(e)))])),_:2},1024)])),_:1})};const J={},M=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`/${e}`)in J)return;J[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const l=document.createElement("link");return l.rel=t?"stylesheet":"modulepreload",t||(l.as="script",l.crossOrigin=""),l.href=e,document.head.appendChild(l),t?new Promise(((e,t)=>{l.addEventListener("load",e),l.addEventListener("error",t)})):void 0}))).then((()=>e())):e()};var F="/assets/logo.f5c509ab.jpg";const K=s.create({baseURL:"/api",timeout:5e3});function U(e){return K({url:"/auth/login",method:"post",data:e})}function G(e){return K({url:"/auth/register",method:"post",data:e})}function H(e){return K({url:"/auth/reset-password",method:"post",data:e})}function W(){return K({url:"/dashboard/stats",method:"get"})}function Q(e){return K({url:"/alarms",method:"get",params:e})}function X(e){return K({url:`/alarms/${e}/ack`,method:"put"})}function Y(e){return K({url:`/alarms/${e}/clear`,method:"put"})}K.interceptors.request.use((e=>{const t=localStorage.getItem("tea_token");return t&&(e.headers.Authorization="Bearer "+t),e}),(e=>(console.log(e),Promise.reject(e)))),K.interceptors.response.use((e=>e.data),(e=>(console.log("err"+e),i({message:e.message||"����ʧ��",type:"error",duration:5e3}),Promise.reject(e))));const Z={class:"logo-area"},ee={class:"font-bold text-lg"},te={key:0,class:"alarm-dot"},ae={class:"flex items-center text-gray-500"},le={class:"flex items-center"},ne={class:"mr-4 cursor-pointer hover:text-primary"},oe={class:"notification-list"},re={class:"notification-header"},se={key:0,class:"empty-notification"},ie=["onClick"],de={class:"notification-icon"},ce={class:"notification-content"},ue={class:"notification-title"},me={class:"notification-time"},pe={class:"cursor-pointer hover:text-primary flex items-center"},fe={class:"flex items-center cursor-pointer"},_e={class:"ml-2 text-sm text-gray-600"},he={class:"profile-content"},ve={class:"avatar-box"},ge={class:"info-item"},ye={class:"info-item"},xe={__name:"index",setup(s){const R=d(),S=c(!1),z=u({name:"",avatar:"",roles:[]}),N=c(!1),$=C((()=>S.value?"64px":"240px")),B=()=>{S.value=!S.value},J=c(!1),M=()=>{J.value=!J.value;const e=document.documentElement;J.value?e.classList.add("dark"):e.classList.remove("dark")},F=async()=>{try{const e=await K({url:"/auth/user/info",method:"get"});e&&(z.name=e.name,z.avatar=e.avatar,z.roles=e.roles)}catch(e){console.error("获取用户信息失败",e)}},U=c(0);let G=null;const H=c([]),X=async()=>{try{const e=(await W()).alarm_count;e>U.value&&0!==U.value&&(T({title:"新告警提醒",message:`检测到 ${e-U.value} 条新的活动告警，请及时处理！`,type:"error",duration:5e3}),Y()),U.value=e}catch(e){console.error("Polling alarms failed",e)}},Y=async()=>{try{const e=await Q({page:1,size:5,status:"active"});H.value=e.list}catch(e){console.error(e)}},xe=e=>{"logout"===e?be():"profile"===e&&(N.value=!0)},be=()=>{V.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await K({url:"/auth/logout",method:"post"})}catch(e){console.error(e)}finally{localStorage.removeItem("tea_token"),R.push("/login"),i.success("已退出登录")}}))};return m((()=>{F(),X(),Y(),G=setInterval(X,5e3)})),p((()=>{G&&clearInterval(G)})),(s,i)=>{const d=e("Odometer"),c=e("el-icon"),u=e("el-menu-item"),m=e("Collection"),p=e("Cpu"),C=e("Connection"),T=e("el-sub-menu"),V=e("el-menu"),F=e("el-aside"),K=e("el-badge"),G=e("el-link"),W=e("el-popover"),Q=e("el-dropdown-item"),X=e("el-dropdown-menu"),be=e("el-dropdown"),Ee=e("el-avatar"),ke=e("el-header"),Ae=e("router-view"),we=e("el-main"),Le=e("el-container"),Ie=e("el-tag"),je=e("el-dialog");return t(),f(L,null,[n(Le,{class:"h-screen"},{default:l((()=>[n(F,{width:$.value,class:"glass-aside transition-all duration-300"},{default:l((()=>[_("div",Z,[i[2]||(i[2]=_("img",{src:"/assets/logo.f5c509ab.jpg",alt:"Logo",class:"w-8 h-8 mr-2 rounded"},null,-1)),h(_("span",ee,"茶智云",512),[[v,!S.value]])]),n(V,{router:"","default-active":s.$route.path,class:"border-none","text-color":"#606266","active-text-color":"#13c2c2",collapse:S.value},{default:l((()=>[n(u,{index:"/dashboard"},{title:l((()=>[...i[3]||(i[3]=[g("运营总览",-1)])])),default:l((()=>[n(c,null,{default:l((()=>[n(d)])),_:1})])),_:1}),n(u,{index:"/tea-garden/list"},{title:l((()=>[...i[4]||(i[4]=[g("茶园管理",-1)])])),default:l((()=>[n(c,null,{default:l((()=>[n(m)])),_:1})])),_:1}),n(u,{index:"/device/list"},{title:l((()=>[...i[5]||(i[5]=[g("设备管理",-1)])])),default:l((()=>[n(c,null,{default:l((()=>[n(p)])),_:1})])),_:1}),n(u,{index:"/rule/index"},{title:l((()=>[...i[6]||(i[6]=[g("规则配置",-1)])])),default:l((()=>[n(c,null,{default:l((()=>[n(C)])),_:1})])),_:1}),n(u,{index:"/alarm/index"},{title:l((()=>[i[7]||(i[7]=_("span",null,"告警记录",-1)),U.value>0?(t(),f("span",te)):y("",!0)])),default:l((()=>[n(c,null,{default:l((()=>[n(x(b))])),_:1})])),_:1}),n(u,{index:"/task/index"},{title:l((()=>[...i[8]||(i[8]=[g("计划任务",-1)])])),default:l((()=>[n(c,null,{default:l((()=>[n(x(E))])),_:1})])),_:1}),z.roles.includes("admin")||z.roles.includes("super_admin")?(t(),a(T,{key:0,index:"/system"},{title:l((()=>[n(c,null,{default:l((()=>[n(x(k))])),_:1}),i[9]||(i[9]=_("span",null,"系统管理",-1))])),default:l((()=>[n(u,{index:"/system/user"},{default:l((()=>[...i[10]||(i[10]=[g("用户管理",-1)])])),_:1})])),_:1})):y("",!0)])),_:1},8,["default-active","collapse"])])),_:1},8,["width"]),n(Le,null,{default:l((()=>[n(ke,{class:"glass-header"},{default:l((()=>[_("div",ae,[n(c,{class:"mr-2 cursor-pointer hover:text-primary",size:"20",onClick:B},{default:l((()=>[(t(),a(o(S.value?"Expand":"Fold")))])),_:1}),_("span",null,"当前位置 / "+A(s.$route.meta.title),1)]),_("div",le,[_("div",ne,[n(W,{placement:"bottom",width:300,trigger:"click","popper-class":"notification-popover",onShow:Y},{reference:l((()=>[n(K,{value:U.value,hidden:0===U.value,class:"item",type:"danger"},{default:l((()=>[n(c,{size:"20"},{default:l((()=>[n(x(b))])),_:1})])),_:1},8,["value","hidden"])])),default:l((()=>[_("div",oe,[_("div",re,[i[12]||(i[12]=_("span",null,"最新告警",-1)),n(G,{type:"primary",underline:!1,onClick:i[0]||(i[0]=e=>x(R).push("/alarm/index"))},{default:l((()=>[...i[11]||(i[11]=[g("查看全部",-1)])])),_:1})]),0===H.value.length?(t(),f("div",se,[n(c,{size:"30",color:"#909399"},{default:l((()=>[n(x(w))])),_:1}),i[13]||(i[13]=_("p",null,"暂无未处理告警",-1))])):(t(!0),f(L,{key:1},I(H.value,(e=>(t(),f("div",{key:e.id,class:"notification-item",onClick:e=>{R.push("/alarm/index")}},[_("div",de,[n(c,{color:"#f56c6c"},{default:l((()=>[n(x(D))])),_:1})]),_("div",ce,[_("div",ue,A(e.content),1),_("div",me,A(e.created_at),1)])],8,ie)))),128))])])),_:1})]),n(be,{class:"mr-4",trigger:"click",onCommand:M},{dropdown:l((()=>[n(X,null,{default:l((()=>[n(Q,{disabled:!J.value,command:"light"},{default:l((()=>[...i[14]||(i[14]=[g("默认主题",-1)])])),_:1},8,["disabled"]),n(Q,{disabled:J.value,command:"dark"},{default:l((()=>[...i[15]||(i[15]=[g("暗黑模式",-1)])])),_:1},8,["disabled"])])),_:1})])),default:l((()=>[_("div",pe,[n(c,{size:"20"},{default:l((()=>[n(x(j))])),_:1})])])),_:1}),n(be,{trigger:"click",onCommand:xe},{dropdown:l((()=>[n(X,null,{default:l((()=>[n(Q,{command:"profile"},{default:l((()=>[n(c,null,{default:l((()=>[n(x(O))])),_:1}),i[16]||(i[16]=g("账号信息 ",-1))])),_:1}),n(Q,{divided:"",command:"logout"},{default:l((()=>[n(c,null,{default:l((()=>[n(x(P))])),_:1}),i[17]||(i[17]=g("退出登录 ",-1))])),_:1})])),_:1})])),default:l((()=>[_("div",fe,[n(Ee,{size:32,src:z.avatar||"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"},null,8,["src"]),_("span",_e,A(z.name||"用户"),1),n(c,{class:"el-icon--right"},{default:l((()=>[n(x(q))])),_:1})])])),_:1})])])),_:1}),n(we,null,{default:l((()=>[n(Ae,null,{default:l((({Component:e})=>[n(r,{name:"fade-transform",mode:"out-in"},{default:l((()=>[(t(),a(o(e)))])),_:2},1024)])),_:1})])),_:1})])),_:1})])),_:1}),n(je,{modelValue:N.value,"onUpdate:modelValue":i[1]||(i[1]=e=>N.value=e),title:"账号信息",width:"30%"},{default:l((()=>[_("div",he,[_("div",ve,[n(Ee,{size:80,src:z.avatar||"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"},null,8,["src"])]),_("div",ge,[i[18]||(i[18]=_("label",null,"昵称：",-1)),_("span",null,A(z.name),1)]),_("div",ye,[i[19]||(i[19]=_("label",null,"角色：",-1)),(t(!0),f(L,null,I(z.roles,(e=>(t(),a(Ie,{size:"small",key:e,class:"mr-1"},{default:l((()=>[g(A(e),1)])),_:2},1024)))),128))])])])),_:1},8,["modelValue"])],64)}},__scopeId:"data-v-27cc5f54"},be=[{path:"/login",component:()=>M((()=>import("./index.7c381543.js")),["assets/index.7c381543.js","assets/index.e711136c.css","assets/vendor.da7b8729.js"]),meta:{title:"登录"}},{path:"/login/register",component:()=>M((()=>import("./register.2d0420a3.js")),["assets/register.2d0420a3.js","assets/register.ce82879c.css","assets/vendor.da7b8729.js"]),meta:{title:"注册账号"}},{path:"/login/forget",component:()=>M((()=>import("./forget.71d72154.js")),["assets/forget.71d72154.js","assets/forget.3fa8432e.css","assets/vendor.da7b8729.js"]),meta:{title:"找回密码"}},{path:"/",redirect:"/login"},{path:"/dashboard",component:xe,children:[{path:"",component:()=>M((()=>import("./index.ef9770cf.js")),["assets/index.ef9770cf.js","assets/index.021f5e71.css","assets/vendor.da7b8729.js","assets/index.2376e022.js","assets/tea-garden.34ed79bb.js","assets/ImageSelector.6ec4f0f9.js","assets/ImageSelector.f9b493e0.css"]),meta:{title:"运营总览",requiresAuth:!0}}]},{path:"/tea-garden",component:xe,children:[{path:"list",component:()=>M((()=>import("./list.d88cd184.js")),["assets/list.d88cd184.js","assets/list.1ee09f0a.css","assets/vendor.da7b8729.js","assets/tea-garden.34ed79bb.js","assets/device.2995e9c4.js","assets/ImageSelector.6ec4f0f9.js","assets/ImageSelector.f9b493e0.css"]),meta:{title:"茶园列表",requiresAuth:!0}},{path:"detail/:id",component:()=>M((()=>import("./detail.75f71dfd.js")),["assets/detail.75f71dfd.js","assets/detail.cf8ebb79.css","assets/vendor.da7b8729.js","assets/tea-garden.34ed79bb.js","assets/device.2995e9c4.js","assets/rule.85422e5a.js"]),meta:{title:"茶园详情",requiresAuth:!0}}]},{path:"/device",component:xe,children:[{path:"list",component:()=>M((()=>import("./list.fe511cac.js")),["assets/list.fe511cac.js","assets/list.9206202a.css","assets/vendor.da7b8729.js","assets/device.2995e9c4.js","assets/index.2376e022.js"]),meta:{title:"设备列表",requiresAuth:!0}}]},{path:"/rule",component:xe,children:[{path:"index",component:()=>M((()=>import("./index.05f396c3.js")),["assets/index.05f396c3.js","assets/rule.85422e5a.js","assets/device.2995e9c4.js","assets/vendor.da7b8729.js"]),meta:{title:"规则配置",requiresAuth:!0}}]},{path:"/alarm",component:xe,children:[{path:"index",component:()=>M((()=>import("./index.ecdcf8c5.js")),["assets/index.ecdcf8c5.js","assets/vendor.da7b8729.js"]),meta:{title:"告警记录",requiresAuth:!0}}]},{path:"/task",component:xe,children:[{path:"index",component:()=>M((()=>import("./index.979d6ba9.js")),["assets/index.979d6ba9.js","assets/index.b0b8e9a4.css","assets/vendor.da7b8729.js"]),meta:{title:"计划任务",requiresAuth:!0}}]},{path:"/system",component:xe,meta:{title:"系统管理",requiresAuth:!0},children:[{path:"user",component:()=>M((()=>import("./user.f72cf6cb.js")),["assets/user.f72cf6cb.js","assets/user.1353071a.css","assets/vendor.da7b8729.js","assets/tea-garden.34ed79bb.js"]),meta:{title:"用户管理",requiresAuth:!0}}]},{path:"/:pathMatch(.*)*",redirect:"/login"}],Ee=R({history:S(),routes:be});Ee.beforeEach(((e,t,a)=>{const l=localStorage.getItem("tea_token");"/login"!==e.path&&e.meta.requiresAuth&&!l?a("/login"):a()}));var ke={mounted(e,t){const{value:a}=t,l=JSON.parse(localStorage.getItem("tea_roles")||"[]");if(!(l.includes("super_admin")||l.includes("admin")&&localStorage.getItem("tea_user")&&"��������Ա"===JSON.parse(localStorage.getItem("tea_user")).name)){if(!(a&&a instanceof Array&&a.length>0))throw new Error("need roles! Like v-permission=\"['admin','editor']\"");{const t=a;l.some((e=>t.includes(e)))||e.parentNode&&e.parentNode.removeChild(e)}}}};const Ae=z(B);for(const[we,Le]of Object.entries(N))Ae.component(we,Le);Ae.directive("permission",ke),Ae.use(Ee),Ae.use($),Ae.mount("#app");export{F as _,H as a,Q as b,X as c,Y as d,W as g,U as l,G as r,K as s};
