import{u as a,f as e,e as s,D as t,P as l,Q as o,p as r,A as i,g as n,h as c,r as d,o as u,i as m,a as p,w as v,j as f,l as h,E as g,R as _,F as w,y as b,n as y,I as k,q as x,S as C,U as z,c as S,V as L,b as j,W as I,X as q,m as E,Y as V}from"./vendor.da7b8729.js";import{i as A,L as D}from"./index.2376e022.js";import{g as G,b as H}from"./index.e41e9f95.js";import{u as M,g as N}from"./tea-garden.34ed79bb.js";import{_ as O}from"./ImageSelector.6ec4f0f9.js";const P={class:"dashboard-container"},R={class:"stat-content"},U={class:"stat-icon-wrapper"},W={class:"stat-info"},$={class:"stat-value"},F={class:"stat-label"},Q={class:"card-header"},T={class:"header-title"},X={class:"alarm-list-container"},Y={class:"text-red-500"},B={class:"card-header"},J={class:"header-title"},K={class:"section-title mt-8"},Z=["onClick"],aa=["src"],ea=["onClick"],sa={class:"garden-name"},ta={class:"garden-detail-row"},la={class:"truncate"},oa={class:"garden-detail-row"},ra={class:"garden-stats-row"},ia={class:"stat-mini"},na={class:"value"},ca={class:"stat-mini"},da={class:"value"},ua={__name:"index",setup(ua){const ma=a(),pa=e({garden_count:0,device_count:0,device_online_count:0,alarm_count:0,user_count:0,alarm_trend:[]}),va=s(!1),fa=s(null),ha=s([]),ga=s([]),_a=t((()=>[{label:"茶园总数",value:pa.garden_count,icon:l},{label:"设备总数",value:pa.device_count,icon:o},{label:"当前告警",value:pa.alarm_count,icon:r},{label:"用户总数",value:pa.user_count,icon:i}])),wa=s(null);let ba=null,ya=null;const ka=["https://images.unsplash.com/photo-1586616801904-74d47e650d99?q=80&w=600&auto=format&fit=crop","https://images.unsplash.com/photo-1563822249548-9a72b6353cd1?q=80&w=600&auto=format&fit=crop","https://images.unsplash.com/photo-1597479715535-257a06626998?q=80&w=600&auto=format&fit=crop"],xa=a=>a.image_path?a.image_path.startsWith("/")?"http://116.62.25.191:1112/api"+a.image_path:a.image_path:ka[a.id%ka.length],Ca=async a=>{if(fa.value)try{const e=fa.value;await M(e.id,{image_path:a}),e.image_path=a,g.success("封面更新成功")}catch(e){g.error("更新失败"),console.error(e)}},za=async()=>{try{const[a,e,s]=await Promise.all([G(),N({page:1,size:100}),H({page:1,size:5,status:"active"})]);Object.assign(pa,a),ha.value=e.list,ga.value=s.list,_((()=>{(()=>{const a=document.documentElement.classList.contains("dark"),e=a?"#ccc":"#333";if(wa.value){ba=A(wa.value);const s=pa.alarm_trend.map((a=>a.name)),t=pa.alarm_trend.map((a=>a.value));ba.setOption({tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:s,axisLabel:{color:e,fontSize:10},axisTick:{show:!1}},yAxis:{type:"value",axisLabel:{color:e,fontSize:10},splitLine:{lineStyle:{color:a?"#333":"#eee"}}},series:[{name:"告警数量",type:"line",smooth:!0,showSymbol:!1,areaStyle:{color:new D(0,0,0,1,[{offset:0,color:"rgba(245, 108, 108, 0.5)"},{offset:1,color:"rgba(245, 108, 108, 0.0)"}])},itemStyle:{color:"#f56c6c"},lineStyle:{width:2},data:t}]})}})()}))}catch(a){console.error(a)}},Sa=()=>{ba&&ba.resize()};return n((()=>{za(),window.addEventListener("resize",Sa),ya=setInterval(za,3e4)})),c((()=>{window.removeEventListener("resize",Sa),ba&&ba.dispose(),ya&&clearInterval(ya)})),(a,e)=>{var s;const t=d("el-icon"),o=d("el-card"),r=d("el-col"),n=d("el-row"),c=d("el-button"),g=d("el-table-column"),_=d("el-table"),A=d("el-tag");return u(),m("div",P,[p(n,{gutter:24},{default:v((()=>[(u(!0),m(w,null,b(_a.value,((a,s)=>(u(),S(r,{span:6,key:s},{default:v((()=>[p(o,{shadow:"hover",class:L(["stat-card","stat-card-"+s])},{default:v((()=>[f("div",R,[f("div",U,[p(t,{class:"stat-icon"},{default:v((()=>[(u(),S(j(a.icon)))])),_:2},1024)]),f("div",W,[f("div",$,x(a.value),1),f("div",F,x(a.label),1)])]),e[3]||(e[3]=f("div",{class:"card-bg-decoration"},null,-1))])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1}),p(n,{gutter:24,class:"mt-6"},{default:v((()=>[p(r,{span:14},{default:v((()=>[p(o,{shadow:"hover",class:"alarm-list-card"},{header:v((()=>[f("div",Q,[f("span",T,[p(t,{class:"mr-2 text-red-500"},{default:v((()=>[p(y(k))])),_:1}),e[4]||(e[4]=h("实时告警 ",-1))]),p(c,{type:"primary",link:"",onClick:e[0]||(e[0]=a=>y(ma).push("/alarm/index"))},{default:v((()=>[...e[5]||(e[5]=[h("查看全部",-1)])])),_:1})])])),default:v((()=>[f("div",X,[p(_,{data:ga.value,style:{width:"100%"},"show-header":!0,size:"small"},{default:v((()=>[p(g,{prop:"created_at",label:"时间",width:"160"},{default:v((({row:a})=>{return[h(x((e=a.created_at,C(e).format("MM-DD HH:mm"))),1)];var e})),_:1}),p(g,{prop:"gardenName",label:"所属茶园",width:"120","show-overflow-tooltip":""}),p(g,{prop:"deviceName",label:"设备",width:"120","show-overflow-tooltip":""}),p(g,{prop:"content",label:"内容","show-overflow-tooltip":""},{default:v((({row:a})=>[f("span",Y,x(a.content),1)])),_:1})])),_:1},8,["data"])])])),_:1})])),_:1}),p(r,{span:10},{default:v((()=>[p(o,{shadow:"hover",class:"chart-card"},{header:v((()=>[f("div",B,[f("span",J,[p(t,{class:"mr-2"},{default:v((()=>[p(y(z))])),_:1}),e[6]||(e[6]=h("告警趋势 ",-1))])])])),default:v((()=>[f("div",{ref_key:"lineChartRef",ref:wa,class:"chart-container-mini"},null,512)])),_:1})])),_:1})])),_:1}),f("div",K,[p(t,{class:"mr-2"},{default:v((()=>[p(y(l))])),_:1}),e[7]||(e[7]=h("茶园概览 ",-1))]),p(n,{gutter:24,class:"mt-4"},{default:v((()=>[(u(!0),m(w,null,b(ha.value,(a=>(u(),S(r,{span:6,key:a.id,class:"mb-6"},{default:v((()=>[p(o,{shadow:"hover",class:L(["garden-card",{"has-alarm":a.alarmCount>0}])},{default:v((()=>[f("div",{class:"garden-image-wrapper",onClick:e=>y(ma).push(`/tea-garden/detail/${a.id}`)},[f("img",{src:xa(a),class:"garden-image",alt:"Garden Image"},null,8,aa),f("div",{class:L(["garden-status","active"===a.status?"status-active":"status-inactive"])},x("active"===a.status?"正常运营":"维护中"),3),f("div",{class:"card-actions",onClick:e[1]||(e[1]=I((()=>{}),["stop"]))},[p(c,{type:"primary",circle:"",size:"small",icon:y(q),class:"action-btn",onClick:e=>(a=>{fa.value=a,va.value=!0})(a)},null,8,["icon","onClick"])])],8,Z),f("div",{class:"garden-info",onClick:e=>y(ma).push(`/tea-garden/detail/${a.id}`)},[f("h3",sa,[h(x(a.name)+" ",1),a.alarmCount>0?(u(),S(A,{key:0,type:"danger",size:"small",effect:"dark",class:"ml-2"},{default:v((()=>[h(x(a.alarmCount)+" 告警 ",1)])),_:2},1024)):E("",!0)]),f("div",ta,[p(t,null,{default:v((()=>[p(y(V))])),_:1}),f("span",la,x(a.address||"暂无地址"),1)]),f("div",oa,[p(t,null,{default:v((()=>[p(y(i))])),_:1}),f("span",null,"负责人: "+x(a.manager||"未设置"),1)]),f("div",ra,[f("div",ia,[e[8]||(e[8]=f("span",{class:"label"},"面积",-1)),f("span",na,x(a.area||0)+" 亩",1)]),f("div",ca,[e[9]||(e[9]=f("span",{class:"label"},"设备",-1)),f("span",da,x(a.totalCount||0)+" 台",1)])])],8,ea)])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1}),p(O,{modelValue:va.value,"onUpdate:modelValue":e[2]||(e[2]=a=>va.value=a),"current-image":null==(s=fa.value)?void 0:s.image_path,onSelect:Ca},null,8,["modelValue","current-image"])])}},__scopeId:"data-v-e68b95e6"};export{ua as default};
